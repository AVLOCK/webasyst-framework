{$_capture_array = []}
{strip}
<div class="d-widgets-block">
    {* LOAD RESOURCES *}
    <script src="{$wa_url}wa-content/js/d3/d3.min.js"></script>
    <div id="d-widgets-block">
        {foreach $widgets as $block => $block_widgets}
            <div class="widget-group-wrapper">
                {foreach $block_widgets as $w}

                    {include file="./DashboardWidget.html" inline}

                    {* INIT WIDGET*}
                    {capture append="_capture_array"}
                        <script>
                            DashboardWidgets[{$w.id}] = new DashboardWidget({
                                widget_id: {$w.id},
                                widget_href: {$w.href|json_encode},
                                widget_sort: {$w.sort},
                                widget_group_index: {$block_widgets@index},
                                widget_size: {
                                    width: {$w.size.0},
                                    height: {$w.size.1}
                                }
                            });
                        </script>
                    {/capture}
                {/foreach}
            </div>
        {/foreach}

        {* EMPTY GROUP*}
        <div class="widget-group-wrapper"></div>
    </div>

    <div class="empty-widgets-wrapper {if empty($widgets)}is-shown{/if}" id="empty-widgets-wrapper">
        [`Your dashboard is empty. Add some widgets by clicking Customize dashboard on the top.`]
    </div>

    <div id="widgets-list-wrapper" data-backend-url="{$wa_backend_url|escape}"></div>

    {* HIDDEN LOADING SCREEN *}
    <div class="loading-ornament-wrapper">
        <div class="image-wrapper"></div>
    </div>
</div>

{* SCRIPTS *}
{$_capture_array|join:''|strip}
{/strip}