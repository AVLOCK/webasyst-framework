/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
var $jscomp={scope:{},findInternal:function(d,a,c){d instanceof String&&(d=String(d));for(var b=d.length,e=0;e<b;e++){var f=d[e];if(a.call(c,f,e,d))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,a,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[a]=c.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,a,c,b){if(a){c=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var e=d[b];e in c||(c[e]={});c=c[e]}d=d[d.length-1];b=c[d];a=a(b);a!=b&&null!=a&&$jscomp.defineProperty(c,d,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
!function(d){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?d(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],d):d(jQuery)}(function(d){function a(a){a=a[0];return 0<a.offsetWidth&&0<a.offsetHeight}function c(a){if(a.minTime&&(a.minTime=p(a.minTime)),a.maxTime&&(a.maxTime=p(a.maxTime)),a.durationTime&&"function"!=typeof a.durationTime&&(a.durationTime=p(a.durationTime)),"now"==a.scrollDefault)a.scrollDefault=function(){return a.roundingFunction(p(new Date),
a)};else if(a.scrollDefault&&"function"!=typeof a.scrollDefault){var b=a.scrollDefault;a.scrollDefault=function(){return a.roundingFunction(p(b),a)}}else a.minTime&&(a.scrollDefault=function(){return a.roundingFunction(a.minTime,a)});if("string"===d.type(a.timeFormat)&&a.timeFormat.match(/[gh]/)&&(a._twelveHourTime=!0),!1===a.showOnFocus&&-1!=a.showOn.indexOf("focus")&&a.showOn.splice(a.showOn.indexOf("focus"),1),0<a.disableTimeRanges.length){for(var c in a.disableTimeRanges)a.disableTimeRanges[c]=
[p(a.disableTimeRanges[c][0]),p(a.disableTimeRanges[c][1])];a.disableTimeRanges=a.disableTimeRanges.sort(function(a,b){return a[0]-b[0]});for(c=a.disableTimeRanges.length-1;0<c;c--)a.disableTimeRanges[c][0]<=a.disableTimeRanges[c-1][1]&&(a.disableTimeRanges[c-1]=[Math.min(a.disableTimeRanges[c][0],a.disableTimeRanges[c-1][0]),Math.max(a.disableTimeRanges[c][1],a.disableTimeRanges[c-1][1])],a.disableTimeRanges.splice(c,1))}return a}function b(a){var b=a.data("timepicker-settings"),c=a.data("timepicker-list");
if(c&&c.length&&(c.remove(),a.data("timepicker-list",!1)),b.useSelect)var g=c=d("<select />",{"class":"ui-timepicker-select"});else c=d("<ul />",{"class":"ui-timepicker-list"}),g=d("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),g.css({display:"none",position:"absolute"}).append(c);if(b.noneOption)if(!0===b.noneOption&&(b.noneOption=b.useSelect?"Time...":"None"),d.isArray(b.noneOption))for(var k in b.noneOption){if(parseInt(k,10)==k){var A=e(b.noneOption[k],b.useSelect);c.append(A)}}else A=
e(b.noneOption,b.useSelect),c.append(A);(b.className&&g.addClass(b.className),null===b.minTime&&null===b.durationTime||!b.showDuration)||("function"==typeof b.step?"function":b.step,g.addClass("ui-timepicker-with-duration"),g.addClass("ui-timepicker-step-"+b.step));A=b.minTime;"function"==typeof b.durationTime?A=p(b.durationTime()):null!==b.durationTime&&(A=b.durationTime);k=null!==b.minTime?b.minTime:0;var m=null!==b.maxTime?b.maxTime:k+t-1;k>m&&(m+=t);m===t-1&&"string"===d.type(b.timeFormat)&&b.show2400&&
(m=t);var n=b.disableTimeRanges,v=0,u=n.length,x=b.step;"function"!=typeof x&&(x=function(){return b.step});for(var y=0;m>=k;y++,k+=60*x(y)){var D=k,G=r(D,b);if(b.useSelect)var B=d("<option />",{value:G});else B=d("<li />"),B.addClass(43200>D%86400?"ui-timepicker-am":"ui-timepicker-pm"),B.data("time",86400>=D?D:D%86400);B.text(G);if((null!==b.minTime||null!==b.durationTime)&&b.showDuration)if(G=E(k-A,b.step),b.useSelect)B.text(B.text()+" ("+G+")");else{var J=d("<span />",{"class":"ui-timepicker-duration"});
J.text(" ("+G+")");B.append(J)}u>v&&(D>=n[v][1]&&(v+=1),n[v]&&D>=n[v][0]&&D<n[v][1]&&(b.useSelect?B.prop("disabled",!0):B.addClass("ui-timepicker-disabled")));c.append(B)}(g.data("timepicker-input",a),a.data("timepicker-list",g),b.useSelect)?(a.val()&&c.val(f(p(a.val()),b)),c.on("focus",function(){d(this).data("timepicker-input").trigger("showTimepicker")}),c.on("blur",function(){d(this).data("timepicker-input").trigger("hideTimepicker")}),c.on("change",function(){q(a,d(this).val(),"select")}),q(a,
c.val(),"initial"),a.hide().after(c)):(k=b.appendTo,"string"==typeof k?k=d(k):"function"==typeof k&&(k=k(a)),k.append(g),l(a,c),c.on("mousedown click","li",function(b){a.off("focus.timepicker");a.on("focus.timepicker-ie-hack",function(){a.off("focus.timepicker-ie-hack");a.on("focus.timepicker",z.show)});h(a)||a[0].focus();c.find("li").removeClass("ui-timepicker-selected");d(this).addClass("ui-timepicker-selected");w(a)&&(a.trigger("hideTimepicker"),c.on("mouseup.timepicker click.timepicker","li",
function(a){c.off("mouseup.timepicker click.timepicker");g.hide()}))}))}function e(a,b){var c,e,f;return"object"==typeof a?(c=a.label,e=a.className,f=a.value):"string"==typeof a?c=a:d.error("Invalid noneOption value"),b?d("<option />",{value:f,"class":e,text:c}):d("<li />",{"class":e,text:c}).data("time",String(f))}function f(a,b){return a=b.roundingFunction(a,b),null!==a?r(a,b):void 0}function g(a){a.target!=window&&(a=d(a.target),a.closest(".ui-timepicker-input").length||a.closest(".ui-timepicker-wrapper").length||
(z.hide(),d(document).unbind(".ui-timepicker"),d(window).unbind(".ui-timepicker")))}function h(a){a=a.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&a.disableTouchKeyboard}function k(a,b,c){if(!c&&0!==c)return!1;a=a.data("timepicker-settings");var e=!1;c=a.roundingFunction(c,a);return b.find("li").each(function(a,b){var f=d(b);if("number"==typeof f.data("time"))return f.data("time")==c?(e=f,!1):void 0}),e}function l(a,b){b.find("li").removeClass("ui-timepicker-selected");
var c=p(n(a),a.data("timepicker-settings"));if(null!==c&&(c=k(a,b,c))){var e=c.offset().top-b.offset().top;(e+c.outerHeight()>b.outerHeight()||0>e)&&b.scrollTop(b.scrollTop()+c.position().top-c.outerHeight());c.addClass("ui-timepicker-selected")}}function m(a,b){if(""!==this.value&&"timepicker"!=b){var c=d(this);if(!c.is(":focus")||a&&"change"==a.type){var e=c.data("timepicker-settings"),f=p(this.value,e);if(null===f)return void c.trigger("timeFormatError");var g=!1;if(null!==e.minTime&&null!==e.maxTime&&
(f<e.minTime||f>e.maxTime)&&(g=!0),d.each(e.disableTimeRanges,function(){return f>=this[0]&&f<this[1]?(g=!0,!1):void 0}),e.forceRoundTime){var h=e.roundingFunction(f,e);h!=f&&(f=h,b=null)}e=r(f,e);g?q(c,e,"error")&&c.trigger("timeRangeError"):q(c,e,b)}}}function n(a){return a.is("input")?a.val():a.data("ui-timepicker-value")}function q(a,b,c){if(a.is("input")){a.val(b);var e=a.data("timepicker-settings");e.useSelect&&"select"!=c&&"initial"!=c&&a.data("timepicker-list").val(f(p(b),e))}return a.data("ui-timepicker-value")!=
b?(a.data("ui-timepicker-value",b),"select"==c?a.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(c)&&a.trigger("changeTime"),!0):(a.trigger("selectTime"),!1)}function v(a){switch(a.keyCode){case 13:case 9:break;default:a.preventDefault()}}function x(b){var c=d(this),e=c.data("timepicker-list");if(!e||!a(e)){if(40!=b.keyCode)return!0;z.show.call(c.get(0));e=c.data("timepicker-list");h(c)||c.focus()}switch(b.keyCode){case 13:return w(c)&&(m.call(c.get(0),
{type:"change"}),z.hide.apply(this)),b.preventDefault(),!1;case 38:var f=e.find(".ui-timepicker-selected");return f.length?f.is(":first-child")||(f.removeClass("ui-timepicker-selected"),f.prev().addClass("ui-timepicker-selected"),f.prev().position().top<f.outerHeight()&&e.scrollTop(e.scrollTop()-f.outerHeight())):(e.find("li").each(function(a,b){return 0<d(b).position().top?(f=d(b),!1):void 0}),f.addClass("ui-timepicker-selected")),!1;case 40:return f=e.find(".ui-timepicker-selected"),0===f.length?
(e.find("li").each(function(a,b){return 0<d(b).position().top?(f=d(b),!1):void 0}),f.addClass("ui-timepicker-selected")):f.is(":last-child")||(f.removeClass("ui-timepicker-selected"),f.next().addClass("ui-timepicker-selected"),f.next().position().top+2*f.outerHeight()>e.outerHeight()&&e.scrollTop(e.scrollTop()+f.outerHeight())),!1;case 27:e.find("li").removeClass("ui-timepicker-selected");z.hide();break;case 9:z.hide();break;default:return!0}}function y(b){var c=d(this),e=c.data("timepicker-list"),
f=c.data("timepicker-settings");if(!e||!a(e)||f.disableTextInput)return!0;switch(b.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:f.typeaheadHighlight?l(c,e):e.hide()}}function w(a){var b=a.data("timepicker-settings"),c=null,e=a.data("timepicker-list").find(".ui-timepicker-selected");return e.hasClass("ui-timepicker-disabled")?
!1:(e.length&&(c=e.data("time")),null!==c&&("string"!=typeof c&&(c=r(c,b)),q(a,c,"select")),!0)}function E(a,b){a=Math.abs(a);var c,e,d=Math.round(a/60),f=[];return 60>d?f=[d,u.mins]:(c=Math.floor(d/60),e=d%60,30==b&&30==e&&(c+=u.decimal+5),f.push(c),f.push(1==c?u.hr:u.hrs),30!=b&&e&&(f.push(e),f.push(u.mins))),f.join(" ")}function r(a,b){if("number"!=typeof a)return null;var c=parseInt(a%60),e=parseInt(a/60%60),f=parseInt(a/3600%24),f=new Date(1970,0,2,f,e,c,0);if(isNaN(f.getTime()))return null;
if("function"===d.type(b.timeFormat))return b.timeFormat(f);for(var g="",h=0;h<b.timeFormat.length;h++)switch(c=b.timeFormat.charAt(h)){case "a":g+=11<f.getHours()?u.pm:u.am;break;case "A":g+=11<f.getHours()?u.PM:u.AM;break;case "g":c=f.getHours()%12;g+=0===c?"12":c;break;case "G":c=f.getHours();a===t&&(c=b.show2400?24:0);g+=c;break;case "h":c=f.getHours()%12;0!==c&&10>c&&(c="0"+c);g+=0===c?"12":c;break;case "H":c=f.getHours();a===t&&(c=b.show2400?24:0);g+=9<c?c:"0"+c;break;case "i":e=f.getMinutes();
g+=9<e?e:"0"+e;break;case "s":c=f.getSeconds();g+=9<c?c:"0"+c;break;case "\\":h++;g+=b.timeFormat.charAt(h);break;default:g+=c}return g}function p(a,b){if(""===a||null===a)return null;if("object"==typeof a)return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds();if("string"!=typeof a)return a;a=a.toLowerCase().replace(/[\s\.]/g,"");"a"!=a.slice(-1)&&"p"!=a.slice(-1)||(a+="m");var c="("+u.am.replace(".","")+"|"+u.pm.replace(".","")+"|"+u.AM.replace(".","")+"|"+u.PM.replace(".","")+")?",e=a.match(new RegExp("^"+
c+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+c+"$"));if(!e)return null;c=parseInt(1*e[2],10);if(24<c){if(b&&!1===b.wrapHours)return null;c%=24}var d=e[1]||e[5],f=c;12>=c&&d&&(f=d==u.pm||d==u.PM,f=12==c?f?12:0:c+(f?12:0));e=3600*f+60*(1*e[3]||0)+(1*e[4]||0);12>c&&!d&&b&&b._twelveHourTime&&b.scrollDefault&&(c=e-b.scrollDefault(),0>c&&c>=t/-2&&(e=(e+t/2)%t));return e}var t=86400,u={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},z={init:function(a){return this.each(function(){var e=
d(this),f=[],g;for(g in d.fn.timepicker.defaults)e.data(g)&&(f[g]=e.data(g));f=d.extend({},d.fn.timepicker.defaults,f,a);if(f.lang&&(u=d.extend(u,f.lang)),f=c(f),e.data("timepicker-settings",f),e.addClass("ui-timepicker-input"),f.useSelect)b(e);else{if(e.prop("autocomplete","off"),f.showOn)for(var h in f.showOn)e.on(f.showOn[h]+".timepicker",z.show);e.on("change.timepicker",m);e.on("keydown.timepicker",x);e.on("keyup.timepicker",y);f.disableTextInput&&e.on("keydown.timepicker",v);m.call(e.get(0),
null,"initial")}})},show:function(c){var e=d(this),f=e.data("timepicker-settings");if(c&&c.preventDefault(),f.useSelect)return void e.data("timepicker-list").focus();h(e)&&e.blur();c=e.data("timepicker-list");if(!e.prop("readonly")&&(c&&0!==c.length&&"function"!=typeof f.durationTime||(b(e),c=e.data("timepicker-list")),!a(c))){e.data("ui-timepicker-value",e.val());l(e,c);z.hide();c.show();var m={};f.orientation.match(/r/)?m.left=e.offset().left+e.outerWidth()-c.outerWidth()+parseInt(c.css("marginLeft").replace("px",
""),10):m.left=e.offset().left+parseInt(c.css("marginLeft").replace("px",""),10);"t"==(f.orientation.match(/t/)?"t":f.orientation.match(/b/)?"b":e.offset().top+e.outerHeight(!0)+c.outerHeight()>d(window).height()+d(window).scrollTop()?"t":"b")?(c.addClass("ui-timepicker-positioned-top"),m.top=e.offset().top-c.outerHeight()+parseInt(c.css("marginTop").replace("px",""),10)):(c.removeClass("ui-timepicker-positioned-top"),m.top=e.offset().top+e.outerHeight()+parseInt(c.css("marginTop").replace("px",""),
10));c.offset(m);m=c.find(".ui-timepicker-selected");if(!m.length){var q=p(n(e));null!==q?m=k(e,c,q):f.scrollDefault&&(m=k(e,c,f.scrollDefault()))}m&&m.length?(m=c.scrollTop()+m.position().top-m.outerHeight(),c.scrollTop(m)):c.scrollTop(0);return f.stopScrollPropagation&&d(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(a){a.preventDefault();var b=d(this).scrollTop();d(this).scrollTop(b+a.originalEvent.deltaY)}),d(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
g),d(window).on("resize.ui-timepicker",g),f.closeOnWindowScroll&&d(document).on("scroll.ui-timepicker",g),e.trigger("showTimepicker"),this}},hide:function(b){b=d(this);var c=b.data("timepicker-settings");return c&&c.useSelect&&b.blur(),d(".ui-timepicker-wrapper").each(function(){var b=d(this);if(a(b)){var c=b.data("timepicker-input"),e=c.data("timepicker-settings");e&&e.selectOnBlur&&w(c);b.hide();c.trigger("hideTimepicker")}}),this},option:function(a,e){return"string"==typeof a&&"undefined"==typeof e?
d(this).data("timepicker-settings")[a]:this.each(function(){var f=d(this),g=f.data("timepicker-settings"),h=f.data("timepicker-list");"object"==typeof a?g=d.extend(g,a):"string"==typeof a&&(g[a]=e);g=c(g);f.data("timepicker-settings",g);h&&(h.remove(),f.data("timepicker-list",!1));g.useSelect&&b(f)})},getSecondsFromMidnight:function(){return p(n(this))},getTime:function(a){var b=n(this);if(!b)return null;b=p(b);if(null===b)return null;a||(a=new Date);a=new Date(a);return a.setHours(b/3600),a.setMinutes(b%
3600/60),a.setSeconds(b%60),a.setMilliseconds(0),a},isVisible:function(){var b=this.data("timepicker-list");return!(!b||!a(b))},setTime:function(a){var b=this.data("timepicker-settings"),c=b.forceRoundTime?f(p(a),b):r(p(a),b);return a&&null===c&&b.noneOption&&(c=a),q(this,c),this.data("timepicker-list")&&l(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var a=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),a.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};d.fn.timepicker=function(a){return this.length?z[a]?this.hasClass("ui-timepicker-input")?z[a].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof a&&a?void d.error("Method "+a+" does not exist on jQuery.timepicker"):z.init.apply(this,arguments):this};d.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(a,b){if(null===a)return null;if("number"!=typeof b.step)return a;var c=a%(60*b.step);return c>=30*b.step?a+=60*b.step-c:a-=c,a==t&&b.show2400?a:a%t},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(d){d.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,title_pattern:"Team \u2014 %s",init:function(a){["is_debug","app_url","locales"].forEach(function(c){d.team[c]=a[c]});d(document).ajaxSend(function(a,b,e){e.crossDomain||"POST"!==(e.type||"").toUpperCase()||(a=(a=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(a[1]):"",e.data=e.data||"","string"==typeof e.data?-1==e.data.indexOf("_csrf=")&&(e.data+=(0<e.data.length?"&":"")+"_csrf="+a,b.setRequestHeader("Content-type",
"application/x-www-form-urlencoded")):"object"==typeof e.data&&(e.data._csrf=a))});d.team.content=new ContentRouter({$content:d("#t-content")});d.team.setSync()},setTitle:function(a){if(a){var c=history.state;c&&(c.title=a);document.title=d.team.title_pattern.replace("%s",a)}},confirmContactDelete:function(a,c){d.post("?module=users&action=prepareDelete",{id:a},function(a){var b=new TeamDialog({html:a});if(c&&c.onInit)c.onInit();if(c&&c.onCancel)b.$wrapper.on("close",c.onCancel);if(c.onCancel||c.onDelete)b.$wrapper.on("contacts_deleted",
function(a,e){c&&c.onCancel&&b.$wrapper.off("close",c.onCancel);if(c&&c.onDelete)c.onDelete(e)})})},setSync:function(){function a(){console.log("send sync request");d.post(d.team.app_url+"?module=calendarExternal&action=sync").always(function(){setTimeout(a,c)}).error(function(){return!1})}var c=3E4+Math.floor(100*Math.random())/100*3E4;setTimeout(a,d.team.is_debug?100:c/2)}}})(jQuery);
var ContentRouter=function(d){ContentRouter=function(a){this.$window=d(window);this.$content=a.$content;this.api_enabled=window.history&&window.history.pushState;this.xhr=!1;this.is_enabled=!0;this.initClass()};ContentRouter.prototype.initClass=function(){this.bindEvents()};ContentRouter.prototype.bindEvents=function(){var a=this,c=window.location.origin+d.team.app_url;d(document).on("click","a",function(b){var e=a.is_enabled&&this.href.substr(0,c.length)==c;b.ctrlKey||b.shiftKey||b.metaKey||!e||
(b.preventDefault(),a.load(this.href))});d("#wa-app-team").on("click","a",function(a){a.stopPropagation()});a.api_enabled&&(window.onpopstate=function(b){b.stopPropagation();a.onPopState(b)})};ContentRouter.prototype.load=function(a,c){var b=this;if(!(0<=a.indexOf(d.team.app_url)))return alert("Determine the path error"),!1;b.animate(!0);b.xhr&&b.xhr.abort();d(document).trigger("wa_before_load",{content_uri:a});b.xhr=d.get(a,function(e){!c&&b.api_enabled&&history.pushState({reload:!0,content_uri:a},
"",a);b.setContent(e);b.animate(!1);b.xhr=!1;d(document).trigger("wa_loaded")})};ContentRouter.prototype.reload=function(){var a=this.api_enabled&&history.state&&history.state.content_uri?history.state.content_uri:!1;a&&this.load(a,!0)};ContentRouter.prototype.setContent=function(a){this.$content.html(a)};ContentRouter.prototype.onPopState=function(a){if(a=a.state||!1){if(!a.content_uri)return alert("Determine the path error"),!1;d(document).trigger("wa_before_load",{content_uri:a.content_uri});a.reload?
this.reload(a.content_uri):a.content&&this.setContent(a.content);a.title&&d.team.setTitle(a.title);d.team.sidebar.selectLink(a.content_uri);d(document).trigger("wa_loaded")}else location.reload()};ContentRouter.prototype.animate=function(a){var c=this.$content;d(".router-loading-indicator").remove();a&&(a=c.find(".t-content-header h1"),a.length&&a.append('<i class="icon16 loading router-loading-indicator"></i>'))};return ContentRouter}(jQuery),TeamDialog=function(d){TeamDialog=function(a){this.$wrapper=
d(a.html);this.$block=!1;if(this.is_full_screen=this.$wrapper.hasClass("is-full-screen"))this.$block=this.$wrapper.find(".t-dialog-block");this.position=a.position||!1;this.is_closed=!1;this.userPosition=a.setPosition||!1;this.onBgClick=a.onBgClick||!1;this.onOpen=a.onOpen||function(){};this.onClose=a.onClose||function(){};this.onRefresh=a.onRefresh||!1;this.onResize=a.onResize||!1;this.initClass()};TeamDialog.prototype.initClass=function(){this.$wrapper.data("teamDialog",this);this.show();this.bindEvents()};
TeamDialog.prototype.bindEvents=function(){var a=this,c=d(document),b=a.$block?a.$block:a.$wrapper;setTimeout(function(){function e(){a.is_closed||a.close();c.off("click",e);c.off("wa_before_load",e)}function f(){d.contains(document,a.$wrapper[0])?a.resize():d(window).off("resize",f)}c.on("click",e);c.on("wa_before_load",e);a.$wrapper.on("close",e);if(a.is_full_screen)a.$wrapper.on("click",".t-dialog-background",function(b){if(a.onBgClick)a.onBgClick(b);else b.stopPropagation()});b.on("click",function(a){a.stopPropagation()});
d(document).on("keyup",function(b){27===b.keyCode&&a.close()});b.on("click",".js-close-dialog",function(){e()});if(a.is_full_screen)d(window).on("resize",f)},0)};TeamDialog.prototype.show=function(){d("body").append(this.$wrapper);this.setPosition();this.onOpen(this.$wrapper,this)};TeamDialog.prototype.setPosition=function(){function a(a){return{left:parseInt((b-a.width)/2),top:parseInt((e-a.height)/2)}}var c=d(window),b=c.width(),e=this.is_full_screen?c.height():d(document).height(),c=this.$block?
this.$block:this.$wrapper,f=c.outerWidth(),g=c.outerHeight(),h;h=this.position?this.position:(this.userPosition?this.userPosition:a)({width:f,height:g});0<h.left&&h.left+f>b&&(h.left=b-f-10);0<h.top?h.top+g>e&&(h.top=e-g-10):(h.top=10,this.is_full_screen&&(f=c.find(".t-dialog-content"),f.hide(),g=c.outerHeight(),f.height(e-g-20).addClass("is-long-content").show()));c.css(h)};TeamDialog.prototype.close=function(){this.is_closed=!0;this.$wrapper.remove();this.onClose(this.$wrapper,this)};TeamDialog.prototype.refresh=
function(){this.onRefresh&&(this.onRefresh(),this.close())};TeamDialog.prototype.resize=function(){this.$block.addClass("is-animated");this.setPosition();if(this.onResize)this.onResize(this.$wrapper,this)};return TeamDialog}(jQuery),TeamEditable=function(d){TeamEditable=function(a){this.$wrapper=a.$wrapper;this.save=a.onSave||function(){};this.render=a.onRender||!1;this.text=(this.is_empty=this.$wrapper.hasClass("is-empty"))?"":this.$wrapper.text();this.is_edit=this.$field=!1;this.initClass()};TeamEditable.prototype.initClass=
function(){this.$field=this.renderField();this.bindEvents()};TeamEditable.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",function(){a.toggle()});a.$field.on("blur",function(){a.save(a)});a.$field.on("keyup",function(c){var b=27===c.keyCode;13===c.keyCode?a.save(a):b&&(a.$field.val(a.text),a.toggle("hide"))})};TeamEditable.prototype.renderField=function(){var a=this.$wrapper.text(),c=d('<input class="bold" type="text" name="" />');this.is_empty||c.val(a);var b=this.$wrapper.parent().width(),
a=this.$wrapper.width(),b=600<b?600:b-50;c.width(a>b?a:b).hide();this.$wrapper.after(c);this.render&&this.render(this,c);return c};TeamEditable.prototype.toggle=function(a){(a="hide"!==a)?(this.$wrapper.hide(),this.$field.show().focus()):(this.$wrapper.show(),this.$field.hide());this.is_edit=a};return TeamEditable}($);var Sidebar=function(d){var a=function(){a=function(a){this.$window=d(window);this.$wrapper=a.$wrapper;this.$block=a.$block;this.$content=a.$content;this.top_fix_class="fixed-to-top";this.bottom_fix_class="fixed-to-bottom";this.debug=!1;this.initClass()};a.prototype.log=function(a){this.debug&&console.log(a)};a.prototype.initClass=function(){function a(){if(d.contains(document,v[0])){var b=Math.floor(k.$content.outerHeight()),c=Math.floor(v.outerHeight()),m=Math.floor(q.height()),l=n.scrollTop(),
C=Math.floor(v.offset().top),F=z>l?1:-1,I=l-w;A=v.width();if(!(!E&&m>y&&760<=x)||b&&b<c)E?(C=Math.floor(q.height()),F=Math.floor(q.offset().top),F=C+F-y-l,I=c-y,E=!1,C>c&&l>w&&(I<F?f(0):g())):h();else{var b=y>c+0,m=l<=w,H=parseInt(C+c-l-y),c=0<H,H=0>=H;if(b)0<I+0?(r||p||!t)&&f(0):(r||t||p||u)&&h();else if(m){if(r||p||t)u?C<=w&&h():h()}else c?0<F?C>=0+l&&(r||!t||p)&&f():(!r||t||p)&&e(C-w):H?0<F?(!r||t||p)&&e(C-w):(r||t||!p)&&g():(!r||t||p)&&e(C-w)}z=l}else n.off("scroll",a)}function b(){d.contains(document,
v[0])?(x=Math.floor(n.width()),y=Math.floor(n.height()),h(),n.trigger("scroll")):n.off("scroll",b)}function e(a){k.log("Manual top scroll position");v.css("top",a).width(A).removeClass(l).removeClass(m);r=!0;t=p=u=!1}function f(a){k.log("Fixed to top scroll position");v.removeAttr("style").width(A).removeClass(m).addClass(l);a&&(u=!0,v.css("top",a));r=p=!1;t=!0}function g(){k.log("Fixed to bottom scroll position");v.removeAttr("style").width(A).removeClass(l).addClass(m);r=t=u=!1;p=!0}function h(){k.log("Default scroll position");
v.removeAttr("style").removeClass(m).removeClass(l);r=t=p=u=!1}var k=this,l=k.top_fix_class,m=k.bottom_fix_class,n=k.$window,q=k.$wrapper,v=k.$block,x=Math.floor(n.width()),y=Math.floor(n.height()),w=v.offset().top,E=!0,r=!1,p=!1,t=!1,u=!1,z=0,A;n.on("scroll",a).on("resize",b)};return a}();Sidebar=function(a){this.$wrapper=a.$wrapper;this.$groupsWrapper=this.$wrapper.find(".t-groups-list");this.$groups=this.$groupsWrapper.find("> li");this.$locationsWrapper=this.$wrapper.find(".t-locations-list");
this.$locations=this.$locationsWrapper.find("> li");this.$searchForm=this.$wrapper.find(".t-search-form");this.app_url=a.app_url;this.selected_class="selected";this.storage_count_name="team/sidebar_counts";this.can_sort=a.can_sort;this.link_count_update_date=!1;this.$activeMenuItem=this.$wrapper.find("li."+this.selected_class+":first")||!1;this.counters={};this.xhr=this.is_locked=this.storageCount=!1;this.timer=0;this.initClass()};Sidebar.prototype.initClass=function(){this.bindEvents();this.setCounts();
this.initElasticBlock();this.initUpdater();this.can_sort&&this.initSortable();this.initDroppable();this.$activeMenuItem.length||this.selectLink()};Sidebar.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click","li > a",function(b){a.onLinkClick(d(this))});a.$wrapper.on("click",".js-add-user-group",function(b){b.preventDefault();a.showGroupDialog()});a.$wrapper.on("click",".js-add-user-location",function(b){b.preventDefault();a.showGroupDialog(!0)});a.$searchForm.on("submit",function(b){b.preventDefault();
(b=d.trim(a.$searchForm.find(".t-search-field").val()))&&a.showSearch(b)});d("#t-new-user-link").on("click",function(b){b.preventDefault();b.stopPropagation();a.showInviteDialog()})};Sidebar.prototype.onLinkClick=function(a){var b=a.attr("href");b&&"javascript:"!=b.substr(0,11)&&!a.hasClass("js-no-highlight")&&(this.setItem(a.closest("li")),d.team.setTitle(a.text()))};Sidebar.prototype.setItem=function(a){if(this.$activeMenuItem&&this.$activeMenuItem[0]==a[0])return!1;this.$activeMenuItem&&this.$activeMenuItem.removeClass(this.selected_class);
a.addClass(this.selected_class);this.$activeMenuItem=a};Sidebar.prototype.selectLink=function(a){var b;if(a)b=this.$wrapper.find('a[href="'+a+'"]:first');else if(!1===a)return this.$activeMenuItem&&(this.$activeMenuItem.removeClass(this.selected_class),this.$activeMenuItem=null),!1;if(b&&b.length)this.setItem(b.closest("li"));else{a=this.$wrapper.find("a[href^='"+this.app_url+"']");var c=location.pathname,f=0,g=0;a.each(function(a){var b=d(this).attr("href"),e=b.length;0<=c.indexOf(b)&&e>f&&(f=e,
g=a)});if(g||0===g)b=a.eq(g),this.setItem(b.closest("li"))}};Sidebar.prototype.reload=function(){var a=this,b=a.app_url+"?module=sidebar";clearTimeout(a.timer);a.xhr&&a.xhr.abort();a.xhr=d.get(b,function(b){a.xhr=!1;a.$wrapper.replaceWith(b)})};Sidebar.prototype.showInviteDialog=function(){var a=this;a.is_locked||(a.is_locked=!0,d.get(d.team.app_url+"?module=users&action=inviteform",function(b){a.is_locked=!1;new TeamDialog({html:b})}))};Sidebar.prototype.showGroupDialog=function(a){var b=this,c=
d.team.app_url+"?module=group&action=edit";a={type:a?"location":"group"};b.is_locked||(b.is_locked=!0,d.get(c,a,function(a){new TeamDialog({html:a});b.is_locked=!1}))};Sidebar.prototype.setCounts=function(){function a(a,b,c,f){if(0<=a.indexOf(e.app_url)){var g=e.$wrapper.find('a[href="'+a+'"]');if(g.length){c=b-c;var h=d('<strong class="small highlighted t-indicator '+(0<=c?"is-green":"is-red")+'">'+c+"</strong>");0<=c&&(g.append(h),g.one("click",function(c){c.preventDefault();h.remove();e.saveCount(a,
b);e.link_count_update_date=f;d(document).one("wa_loaded",function(){e.link_count_update_date=!1})}))}}}function b(){var a=new Date,b=parseInt(a.getUTCDate()),c=parseInt(a.getUTCMonth())+1,e=parseInt(a.getUTCFullYear()),d=parseInt(a.getUTCHours()),f=parseInt(a.getUTCMinutes()),a=parseInt(a.getUTCSeconds());return result={year:e,month:c,day:b,hours:d,minutes:f,seconds:a}}var e=this,f=function(){var a={},c=e.$wrapper.find("li .js-count"),f=b();c.each(function(){var b=d(this),c=parseInt(b.text()),g=
b.closest("li").find("> a");0<=c&&(e.counters[g.attr("href")]=b,a[g.attr("href")]={count:c,date:f})});return a}(),g=function(a){var b={};(a=localStorage.getItem(a))&&(b=JSON.parse(a));return b}(e.storage_count_name);e.storageCount=d.extend(!0,{},f);g&&d.each(g,function(b,c){var d=b in f&&0<=f[b].count&&f[b].count!=c.count;0<=c.count&&d&&(e.storageCount[b].count=c.count,e.storageCount[b].date=c.date,a(b,f[b].count,c.count,c.date))});e.setStorage()};Sidebar.prototype.saveCount=function(a,b){a in this.storageCount&&
(this.storageCount[a].count=b);this.setStorage()};Sidebar.prototype.updateCount=function(a,b){var c;if(!a||!b&&0!==b)return!1;c=this.counters[a]||!1;this.saveCount(a,b);c.length?c.text(b):this.reload()};Sidebar.prototype.setStorage=function(){localStorage.setItem(this.storage_count_name,JSON.stringify(this.storageCount))};Sidebar.prototype.initElasticBlock=function(){var c=this;d(document).ready(function(){new a({$wrapper:d("#wa-app"),$block:c.$wrapper,$content:d("#t-content")});var b=d(window);0<
b.scrollTop()&&b.trigger("scroll")})};Sidebar.prototype.initUpdater=function(){var a=this;a.timer=setTimeout(function(){d.contains(document,a.$wrapper[0])&&a.reload()},3E5)};Sidebar.prototype.initSortable=function(){function a(a){var b=[];a.find("> li").each(function(){var a=d(this).data("group-id");a&&0<a&&b.push(a)});return b}function b(a,b){l&&(l.abort(),l=!1);l=d.post(a,b,function(){l=!1})}var e=this.$groupsWrapper,f=this.$locationsWrapper,g=this.$locations,h=this.app_url+"?module=group&action=sortSave",
k,l=!1;1<this.$groups.length&&e.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(a,b){k=b.item.index()},stop:function(c,f){f.item.removeAttr("style");if(k!=f.item.index()){var g=a(e),m=[];d.each(g,function(a,b){m.push({name:"groups[]",value:b})});b(h,m)}}});1<g.length&&f.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(a,b){k=b.item.index()},stop:function(c,e){e.item.removeAttr("style");if(k!=e.item.index()){var d=a(f);b(h,{locations:d})}}})};
Sidebar.prototype.initDroppable=function(){function a(a,c){var e=parseInt(a.data("group-id")),f=parseInt(c.data("user-id")),k=d.team.app_url+"?module=group&action=userAdd";if(!(0<e&&0<f))return!1;e={user_id:f,group_id:e};b&&b.abort();b=d.post(k,e,function(a){"ok"==a.status&&d.team.sidebar.reload();b=!1})}var b=!1;this.$groups.each(function(){var b=d(this);b.hasClass("js-drop-place")&&b.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(a,c){c.draggable.hasClass("ui-draggable")||
b.removeClass("is-hovered")},drop:function(b,c){a(d(this),c.draggable)}})});this.$locations.each(function(){var b=d(this);b.hasClass("js-drop-place")&&b.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(a,c){c.draggable.hasClass("ui-draggable")||b.removeClass("is-hovered")},drop:function(b,c){a(d(this),c.draggable)}})})};Sidebar.prototype.showSearch=function(a){a=encodeURIComponent(a);d.team.content.load(this.app_url+"search/"+a+"/")};return Sidebar}(jQuery);var CalendarPage=function(d){var a=function(c){a=function(a){this.$wrapper=a.$wrapper;this.$monthSelect=this.$wrapper.find(".month");this.$yearSelect=this.$wrapper.find(".year");this.filters_href=a.filters_href;this.month=parseInt(this.$monthSelect.val());this.year=parseInt(this.$yearSelect.val());this.initClass()};a.prototype.initClass=function(){var a=this;a.$monthSelect.on("change",function(){var b=c(this).val();b&&(a.month=parseInt(b));a.useFilter();return!1});a.$yearSelect.on("change",function(){var b=
c(this).val();b&&(a.year=parseInt(b));a.useFilter();return!1});a.$wrapper.on("click",".t-arrow",function(){var b=c(this);b.hasClass("left")&&a.changeMonth(!1);b.hasClass("right")&&a.changeMonth(!0);a.useFilter();return!1})};a.prototype.changeMonth=function(a){a?12<=this.month?(this.month=1,this.year++):this.month++:1>=this.month?(this.month=12,this.year--):this.month--};a.prototype.useFilter=function(){var a="start="+(this.year+"-"+(9<this.month?this.month:"0"+this.month)+"-01"),e=this.filters_href.split("?"),
d=e[0],e=e[1]||"",e=0<=e.indexOf("&")?e.split("&"):[e],g=!1;e.length&&c.each(e,function(a,b){"start"==b.split("=")[0]&&(g=a)});g||0===g?e[g]=a:e.push(a);a=d+"?"+e.join("&");c.team.content.load(a)};return a}(jQuery);CalendarPage=function(a){this.$wrapper=a.$wrapper;this.$dateFilter=a.$dateFilter;this.filters_href=a.filters_href;this.user_id=a.user_id;this.local_storage=new d.store;this.initClass()};CalendarPage.prototype.initClass=function(){new a({$wrapper:this.$dateFilter,filters_href:this.filters_href});
this.initInfoBlock()};CalendarPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),b=this.local_storage;b.get("team/calendar_info_warn_block_hide")?a.hide():a.show();a.find(".t-info-notice-toggle").on("click",function(){b.set("team/calendar_info_warn_block_hide",1);a.hide()})};return CalendarPage}(jQuery),TeamCalendar=function(d){function a(a){var b=[];a.each(function(){var a=[];d(this).find(".t-day-ornament").each(function(){a.push(d(this))});b.push(a)});return b}
TeamCalendar=function(c){this.$wrapper=c.$wrapper;this.$rows=this.$wrapper.find(".t-week-row");this.days_count=7;this.weeks_count=this.$rows.length;this.selected_class="is-selected";this.active_class="is-active";this.locales=c.locales;this.is_profile=c.is_profile;this.event_view_uri="?module=schedule&action=eventView";this.event_edit_uri="?module=schedule&action=eventEdit";this.day_uri="?module=schedule&action=day";this.user_id=c.user_id;this.has_right_to_change=c.has_right_to_change;this.selected_user_id=
c.selected_user_id;this.selected_calendar_id=c.selected_calendar_id;this.period_start=c.period_start;this.period_end=c.period_end;this.daysArray=a(this.$rows);this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_h=this.day_w=0;this.dialogs=[];this.end=this.start=this.xhr=!1;this.$selectedDays=[];this.is_locked=!1;this.bindEvents();this.initHoverOnDay();this.initMove()};TeamCalendar.prototype.bindEvents=function(){function a(b){d.contains(document,
f.$wrapper[0])?27===b.keyCode&&f.deselectDays():d(document).off("keydown",a)}function b(a){f.is_locked||(f.is_locked=!0,f.onMouseMove(a),setTimeout(function(){f.is_locked=!1},10));return!1}function e(){f.onMouseUp();f.$wrapper.off("mousemove",b);g.off("mouseup",e);return!1}var f=this,g=d(document);f.has_right_to_change&&(f.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(a){a.stopPropagation();f.clearSelection()}),g.on("mousedown",function(){f.clearSelection()}),f.$wrapper.on("mousedown",
function(a){a.stopPropagation();f.closeDialogs()||(f.onMouseDown(a),f.$wrapper.on("mousemove",b),g.on("mouseup",e));return!1}));f.$wrapper.on("click",".show-full-days-events",function(a){a.preventDefault();f.closeDialogs()||f.showFullDayEvents(d(this))});f.$wrapper.on("click",".t-event-block.js-view-event",function(a){a.preventDefault();f.closeDialogs()||f.showEventDetails(d(this).closest(".t-event-wrapper"))});d(document).on("keydown",a)};TeamCalendar.prototype.showFullDayEvents=function(a){var b=
this,c=a.data("events-id").split(","),c={date:a.data("date"),id:c};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=d.post(b.day_uri,c,function(c){var e=a.closest(".t-action-wrapper"),f=e.closest(".t-week-row"),k=f.offset().top,l=e.offset().left,m=e.outerWidth(),n=f.outerHeight();c=new TeamDialog({html:c,setPosition:function(a){var b=a.width,c=(b-m)/2;a=(a.height-n)/2;a=k-(0<a?a:0);c=l-(0<c?c:0);b=d(window).width()-(c+b);0>b&&(c-=Math.abs(b)+10);return{top:a,left:c}}});b.addDialog(c)})};TeamCalendar.prototype.showEventDetails=
function(a){var b=this;a={"data[id]":a.data("id")};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=d.post(b.event_view_uri,a,function(a){a=new TeamDialog({html:a});b.addDialog(a)})};TeamCalendar.prototype.createEvent=function(){var a=this,b=a.daysArray[a.end.week-1][a.end.day-1],e=a.daysArray[a.start.week-1][a.start.day-1].data("date"),b=b.data("date"),f={"data[start]":!1,"data[end]":!1,"data[contact_id]":a.selected_user_id||a.user_id},g=(new Date).getHours();f["data[start]"]=e.replace("00:00:00",23<=g?"23:59:59":
g+1+":00:00");f["data[end]"]=b.replace("00:00:00",22<=g?"23:59:59":g+2+":00:00");a.selected_calendar_id&&(f["data[calendar_id]"]=a.selected_calendar_id);a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=d.post(a.event_edit_uri,f,function(b){b=new TeamDialog({html:b});a.addDialog(b)})};TeamCalendar.prototype.onMouseDown=function(a){this.end=this.start=this.getDayPosition(a);this.markDays()};TeamCalendar.prototype.onMouseMove=function(a){a=this.getDayPosition(a);this.end&&this.end.week==a.week&&this.end.day==a.day||
(this.end=a,this.markDays())};TeamCalendar.prototype.initHoverOnDay=function(a){function b(){f&&f.removeClass("is-highlighted");f=!1}var c=this,f=!1;c.$wrapper.on("mousemove",function(a){var e=c.getDayPosition(a),g=c.daysArray,l=!1;g[e.week-1]&&g[e.week-1][e.day-1]&&(l=g[e.week-1][e.day-1]);e=l;a=d(a.target);if(a.hasClass("t-event-block")||a.closest(".t-event-block").length||c.start||!e)return b(),!1;if(e.hasClass("is-highlighted"))return!1;f&&b();e.addClass("is-highlighted");f=e}).on("mouseleave",
function(){b()})};TeamCalendar.prototype.onMouseUp=function(){if(this.start.week>this.end.week||this.start.week==this.end.week&&this.start.day>this.end.day){var a={week:this.start.week,day:this.start.day};this.start={week:this.end.week,day:this.end.day};this.end=a}this.createEvent();this.end=this.start=!1};TeamCalendar.prototype.initMove=function(){function a(a){a=e.getDayPosition(a);var b=e.daysArray[a.week-1][a.day-1];if(!b)return console&&console.log&&console.log("error: date is not exist"),!1;
a=d.team.app_url+"?module=schedule&action=eventMove";b={id:parseInt(g.data("id")),start:b.data("date").replace(" 00:00:00","")};k&&k.abort();k=d.post(a,b,function(a){"ok"==a.status&&e.reload()},"json")}function b(a){var b=f.offset(),c=[b.left,b.left+f.outerWidth()],b=[b.top,b.top+f.outerHeight()];e.clearSelection();if(a.pageX<=c[0]||a.pageX>=c[1]||a.pageY<=b[0]||a.pageY>=b[1])return!1;c=parseInt(g.data("day-count")||g.closest(".t-column").attr("colspan"));e.start=e.getDayPosition(a);a=e.daysArray;
var d=e.start,b={week:d.week,day:d.day},d=7-d.day,c=c-1;c<=d?b.day+=c:(b.week+=1,b.day=c-d,b.week>a.length&&(b={week:a.length,day:7}));e.end=b;e.markDays()}var e=this,f=e.$wrapper,g=!1,h=!1,k;f.find(".js-move-event").draggable({helper:"clone",appendTo:"body",cursor:"move",delay:200,cursorAt:{top:11,left:16},start:function(a,b){var c=d(b.helper.context),e=b.helper;g=c;var f=parseInt(g.closest(".t-column").attr("colspan")),h=c.data("move-hint")||!1;h&&e.find(".t-event-block").append("<span class='t-day-count'>("+
h+")</span>");e.addClass("is-clone").css({minWidth:parseInt(c.width()/f)+"px",height:c.height()+"px"})},drag:function(a,c){h||(h=!0,setTimeout(function(){h=!1},100),b(a))},stop:function(a,b){e.clearSelection();g=!1}});f.droppable({drop:function(b){a(b)}})};TeamCalendar.prototype.markDays=function(){this.deselectDays();var a=d.extend({},this.start),b=d.extend({},this.end);a.week>b.week&&(a=d.extend({},this.end),b=d.extend({},this.start));for(var e=a.week,f=b.week,g=e;g<=f;g++){var h,k;e==f?(h=a.day,
k=b.day,h>k&&(h=b.day,k=a.day)):g==e?(h=a.day,k=this.days_count):g==f?(h=1,k=b.day):(h=1,k=this.days_count);for(;h<=k;h++)if(0<g&&0<h){var l=this.daysArray[g-1][h-1];l.length?(l.addClass(this.selected_class),this.$selectedDays.push(l)):console.log("Error: Day isn't exist")}}};TeamCalendar.prototype.getDayPosition=function(a){this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_w=this.wrapper_w/this.days_count;this.day_h=this.wrapper_h/
this.weeks_count;var b=a.pageY-this.wrapper_o.top;a=a.pageX-this.wrapper_o.left;b=parseInt(b/this.day_h)+(0<b%this.day_h?1:0);a=parseInt(a/this.day_w)+(0<a%this.day_w?1:0);return{week:b,day:a}};TeamCalendar.prototype.deselectDays=function(){var a=this;a.$selectedDays.length&&(d.each(a.$selectedDays,function(){d(this).removeClass(a.selected_class)}),a.$selectedDays=[])};TeamCalendar.prototype.clearSelection=function(){this.deselectDays();this.end=this.start=!1};TeamCalendar.prototype.reload=function(){var a=
this,b={};a.closeDialogs();a.selected_user_id&&(b.user=a.selected_user_id);a.selected_calendar_id&&(b.calendar=a.selected_calendar_id);a.period_start&&(b.start=a.period_start);a.period_end&&(b.end=a.period_end);a.is_profile&&(b.period=1);d.get("?module=schedule&action=inc",b,function(b){d.team.calendar=!1;a.$wrapper.closest(".t-calendar-wrapper").replaceWith(b)})};TeamCalendar.prototype.addDialog=function(a){this.dialogs.push(a)};TeamCalendar.prototype.closeDialogs=function(){var a=!1;this.dialogs.length&&
(d.each(this.dialogs,function(b,e){d.contains(document,e.$wrapper[0])&&(e.close(),a=!0)}),this.dialogs=[]);d("#ui-datepicker-div").length&&d(document).trigger("mousedown");return a};return TeamCalendar}(jQuery),DayEventsDialog=function(d){DayEventsDialog=function(a){this.$wrapper=a.$wrapper;this.event_view_uri="?module=schedule&action=eventView";this.xhr=this.dialog=!1;this.initClass()};DayEventsDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".t-event-block.js-view-event",
function(c){c.preventDefault();a.showEventDetails(d(this).closest(".t-event-wrapper"))})};DayEventsDialog.prototype.showEventDetails=function(a){var c=this;a={"data[id]":a.data("id")};c.xhr&&(c.xhr.abort(),c.xhr=!1);c.xhr=d.post(c.event_view_uri,a,function(a){c.dialog=new TeamDialog({html:a})})};return DayEventsDialog}(jQuery),EventEditDialog=function(d){function a(a){var b={};a.find(".menu-v li").each(function(){var a=d(this),e=a.find(".userpic20"),c=a.data("calendar-id");b[c]={id:c,default_status:a.data("default-status"),
name:d.trim(d("<div />").html(a.text()).text()).toLowerCase(),font_color:e.css("color"),bg_color:e.css("background-color")}});return b}function c(a){var b={};a.find(".menu-v li").each(function(){var a=d(this),e=a.find(".userpic20"),c=a.data("user-id");b[c]={id:c,$icon:e,name:d.trim(d("<div />").html(a.text()).text())}});return b}EventEditDialog=function(b){this.$wrapper=b.$wrapper;this.$form=this.$wrapper.find("form");this.$statusToggle=this.$wrapper.find(".t-status-toggle");this.$calendarToggle=
this.$wrapper.find(".t-calendar-toggle");this.$typeToggle=this.$wrapper.find(".t-type-toggle");this.$userToggle=this.$wrapper.find(".t-user-toggle");this.$startAltField=this.$wrapper.find("input[name='data[start_alt]']");this.$endAltField=this.$wrapper.find("input[name='data[end_alt]']");this.$summaryField=this.$form.find("input[name='data[summary]']");this.teamDialog=this.$wrapper.data("teamDialog");this.active_class="is-active";this.extended_class="is-extended";this.selected_class="selected";this.has_error_class=
"error";this.locales=b.locales;this.event_id=b.event_id;this.calendars=a(this.$calendarToggle);this.users=c(this.$userToggle);this.$activeStatusToggle=this.$statusToggle.find("."+this.active_class)||!1;this.is_status=b.is_status;this.is_changed=this.is_locked=!1;this.user_id=b.user_id;this.calendar_id=b.calendar_id;this.summary=b.summary;this.summary_type=b.summary_type;this.end_date_locale=this.start_date_locale=!1;this.initClass()};EventEditDialog.prototype.initClass=function(){this.initDatePicker();
this.initTimePicker();this.bindEvents();this.setStatusLocale();this.is_status&&(this.generateStatusTypes(),this.generatePreview())};EventEditDialog.prototype.bindEvents=function(){var a=this;a.$form.on("submit",function(b){b.preventDefault();a.is_locked||a.save(a.$form);return!1});a.$form.on("click",".js-delete-event",function(b){b.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$statusToggle.on("click",".t-toggle-button",function(){a.changeStatus(d(this));return!1});a.$calendarToggle.on("click",
".menu-v a",function(b){b.preventDefault();a.changeCalendar(d(this))});a.$startAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes();a.generatePreview()});a.$endAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes();a.generatePreview()});a.$summaryField.on("change",function(){a.summary=d(this).val();a.summary_type="custom"});a.$form.on("change","input[name='data[status_summary]']",function(){a.summary=d(this).val();a.$summaryField.val(a.summary)});a.$form.on("change",
'textarea[name="data[description]"]',function(){var b=d(this).val();a.$form.find('textarea[name="data[status_description]"]').val(b)});a.$form.on("change",'textarea[name="data[status_description]"]',function(){var b=d(this).val();a.$form.find('textarea[name="data[description]"]').val(b)});a.$form.on("summaryChange",function(){a.$summaryField.val(a.summary)});if(a.$userToggle.length)a.$userToggle.on("click",".menu-v a",function(b){b.preventDefault();a.changeUser(d(this))});a.$form.on("change",".js-extended-date",
function(){a.dateToggle(d(this));return!1});a.$form.find("input").on("mousedown",function(){var b=d(this);b.hasClass(a.has_error_class)&&b.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()})};EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var a=d(this),c=a.closest(".t-date-wrapper").find("input[type='hidden']");a.datepicker({altField:c,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,
selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(a,b){b.dpDiv.on("click",function(a){a.stopPropagation()});d(a).on("click",function(a){var b=!1,c=d("#ui-datepicker-div");c.length&&"none"!=c.css("display")&&(b=c);b&&(a.stopPropagation(),d(document).trigger("mousedown"),d(this).blur())})}})})};EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var a=d(this),c=!1;a.timepicker();a.on("showTimepicker",function(){var b=a.data("timepicker-list");
c||(b.on("click",function(a){a.stopPropagation()}),c=!0);var e=parseInt(a.offset().top)+parseInt(a.outerHeight())-parseInt(d(window).scrollTop());b.css({position:"fixed",top:e})})})};EventEditDialog.prototype.showDeleteConfirm=function(){var a=this,c={id:a.event_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=d.get("?module=schedule&action=eventDeleteConfirm",c,function(b){new TeamDialog({html:b});a.is_locked=!1;a.close()})};EventEditDialog.prototype.changeStatus=function(a){if(!a.hasClass(this.active_class)){var b=
a.data("status-id");this.$activeStatusToggle&&this.$activeStatusToggle.removeClass(this.active_class);a.addClass(this.active_class);this.$activeStatusToggle=a;this.$form.find('input[name="data[is_status]"]').val(b).trigger("change");(this.is_status=a=1==b)?(this.$wrapper.removeClass("is-event").addClass("is-status"),a=this.$form.find(".js-extended-date"),"checked"!=a.attr("checked")&&a.click()):this.$wrapper.removeClass("is-status").addClass("is-event");this.generateStatusTypes();this.generatePreview();
this.teamDialog.resize()}};EventEditDialog.prototype.changeCalendar=function(a){var b=this,c=a.closest("li"),d=c.data("calendar-id");if(!c.hasClass(b.selected_class)&&!b.is_locked){b.is_locked=!0;b.calendar_id=d;b.$calendarToggle.find("."+b.selected_class).removeClass(b.selected_class);b.$calendarToggle.find(".t-selected-item").html(a.html());b.$form.find('input[name="data[calendar_id]"]').val(d).trigger("change");var h=b.$calendarToggle.find(".menu-v");h.hide();setTimeout(function(){h.removeAttr("style");
b.is_locked=!1},500);b.generateStatusTypes();b.generatePreview()}};EventEditDialog.prototype.changeUser=function(a){var b=this,c=a.closest("li"),d=c.data("user-id");if(!c.hasClass(b.selected_class)&&!b.is_locked){b.is_locked=!0;b.user_id=d;b.$userToggle.find("."+b.selected_class).removeClass(b.selected_class);b.$userToggle.find(".t-selected-item").html(a.html());b.$form.find('input[name="data[contact_id]"]').val(d).trigger("change");var h=b.$userToggle.find(".menu-v");h.hide();setTimeout(function(){h.removeAttr("style");
b.is_locked=!1},200);b.generatePreview()}};EventEditDialog.prototype.save=function(a){var b=this;a=function(a){function c(a){var b=a.split("-");a=parseInt(b[0]);var c=parseInt(b[1]),b=parseInt(b[2]);return 0<a&&0<c&&0<b?new Date(a,c-1,b):!1}function e(a){b.$form.find(".t-error").remove();d.each(a,function(a,c){var e=b.$form.find("[name='"+c.field+"']");e.length&&e.addClass(b.has_error_class).after('<span class="t-error">'+b.locales[c.locale]+"</span>")})}var f={},l=[];d.each(a,function(a,b){f[b.name]=
b.value});f["data[summary_type]"]||(f["data[summary_type]"]="custom");if(a=b.is_status)f["data[description]"]=f["data[status_description]"]?f["data[status_description]"]:"",delete f["data[status_description]"],f["data[summary]"]=b.summary,delete f["data[status_summary]"];d.trim(f["data[summary]"]).length||(a?l.push({field:"data[status_summary]",locale:"empty"}):l.push({field:"data[summary]",locale:"empty"}));f["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||l.push({field:"data[end]",locale:"date"});
f["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||l.push({field:"data[end]",locale:"date"});a=c(f["data[start]"]);var m=c(f["data[end]"]);a>m&&(l.push({field:"data[start_alt]",locale:"period"}),l.push({field:"data[end_alt]",locale:"period"}));if(l.length)return e(l),!1;f["data[start_time]"].length||(f["data[start_time]"]="00:00");f["data[end_time]"].length||(f["data[end_time]"]="00:00");f["data[start]"]=f["data[start]"]+" "+f["data[start_time]"];f["data[end]"]=f["data[end]"]+" "+f["data[end_time]"];
f["data[is_allday]"]=f["data[is_allday]"]?1:0;delete f["data[start_time]"];delete f["data[end_time]"];delete f["data[start_alt]"];delete f["data[end_alt]"];return f}(a.serializeArray());b.is_locked=!0;a?d.post("?module=schedule&action=eventSave",a,function(a){if("ok"==a.status)a.data&&a.data.message&&alert(a.data.message),b.reloadCalendar();else if(a.errors){var c=null;d.each(a.errors,function(a,b){"redirect"===b[0]&&(c=b[1])});c&&(location.href=c)}b.close();b.is_locked=!1},"json"):b.is_locked=!1};
EventEditDialog.prototype.reloadCalendar=function(){d.team.calendar.reload()};EventEditDialog.prototype.dateToggle=function(a){a="checked"==a.attr("checked");var b=this.$form.find(".t-date-wrapper");a?b.removeClass(this.extended_class):b.addClass(this.extended_class)};EventEditDialog.prototype.generatePreview=function(){var a=this.$wrapper.find(".t-preview-block"),c=this.calendars[this.calendar_id],f=c.bg_color,g=c.font_color,h=this.users[this.user_id],c=h.$icon.clone(),h=h.name,f=d("<span class='t-type'>"+
(this.summary?this.summary:this.locales.empty_type)+"</span>").css({background:f,color:g});a.html("").append(c).append("<span class='t-user-name'>"+h+"</span>").append(f)};EventEditDialog.prototype.generateStatusTypes=function(){var a=this,c=a.$typeToggle,f=function(){var b=c.find(".is-template li"),e=b.eq(0),f=b.eq(1),b=d("<ul class='menu-v'></ul>"),l=a.calendars[a.calendar_id];if(l.default_status){var m=e.clone();m.find(".t-type").text(l.default_status);m.find("input:radio").val("default");b.append(m)}m=
e.clone();m.find(".t-type").text(l.name);m.find("input:radio").val("calendar");b.append(m);m=e.clone();m.find(".t-type").text((l.default_status?l.default_status:l.name)+" "+a.locales.till+" "+a.end_date_locale);m.find("input:radio").val("till");b.append(m);e=e.clone();e.find(".t-type").text((l.default_status?l.default_status:l.name)+" "+a.locales.from+" "+a.start_date_locale+" "+a.locales.till+" "+a.end_date_locale);e.find("input:radio").val("interval");b.append(e);e=f.clone();e.find("input:radio").val("custom");
a.summary&&e.find("input:text").val(a.summary);b.append(e);c.find(".value").html("").append(b);return b}();(function(b){b.on("change","input:radio",function(){var b=d(this),c="checked"==b.attr("checked"),e=b.closest("li").find(".t-type"),f=b.closest("li").find("input:text");if(c){if(e.length)a.summary=e.text();else if(f.length)a.summary=f.val();else return!1;a.summary_type=b.val();a.$form.trigger("summaryChange");a.generatePreview()}});b.on("focus set","input:text",function(){var b=d(this),c=b.closest("li").find("input:radio");
"checked"!=c.attr("checked")&&c.attr("checked","checked").trigger("change");b.hasClass(a.has_error_class)&&b.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()});b.on("focus change keyup","input:text",function(){var b=d(this),c=b.val();a.summary=d("<div />").html(b.val()).text();c.length&&(a.summary_type="custom",a.summary=c);a.generatePreview()})})(f);(function(b){!a.summary_type&&a.summary&&(a.summary_type="custom");if(a.summary_type){var c=b.find("input:radio[value='"+a.summary_type+
"']");c.length?(c.click(),"custom"!==a.summary_type&&b.find("input:text").val("")):"default"==a.summary_type?b.find("input[value='calendar']").click():b.find("input:text").val(a.summary?a.summary:"").trigger("change")}else b.find("input:radio:first").click()})(f)};EventEditDialog.prototype.setStatusLocale=function(){function a(a){var b=a.val().split(" ")[0].split("-");a=parseInt(b[2]);var e=parseInt(b[1]),b=parseInt(b[0]),f=(new Date).getFullYear(),g=c.locales.status_type.months[e];a=d.datepicker.formatDate(c.locales.status_type.format,
new Date(b,e-1,a));a=a.replace("f",g);f==b&&(a=a.replace(", "+b,"").replace(" "+b,"").replace(b+" ",""));return a}var c=this,f=c.$wrapper.find("input[name='data[start]']"),g=c.$wrapper.find("input[name='data[end]']");c.start_date_locale=a(f);c.end_date_locale=a(g)};EventEditDialog.prototype.close=function(){this.$wrapper.trigger("close")};return EventEditDialog}(jQuery),EventViewDialog=function(d){EventViewDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");
this.event_id=a.event_id;this.event_edit_uri="?module=schedule&action=eventEdit";this.xhr=!1;this.initClass()};EventViewDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".js-edit-event",function(c){c.preventDefault();a.showEditForm()})};EventViewDialog.prototype.showEditForm=function(){var a=this,c={"data[id]":a.event_id};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=d.post(a.event_edit_uri,c,function(b){a.$wrapper.offset();var c=d.team.calendar;a.close();b=new TeamDialog({html:b});
c.addDialog(b)})};EventViewDialog.prototype.close=function(){this.$wrapper.trigger("close")};return EventViewDialog}(jQuery),EventDeleteDialog=function(d){EventDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.event_id=a.event_id;this.is_locked=!1;this.initClass()};EventDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(c){c.preventDefault();if(!a.is_locked)a["delete"]()})};EventDeleteDialog.prototype["delete"]=
function(){var a=this,c={id:a.event_id};a.is_locked=!0;d.post("?module=schedule&action=eventDelete",c,function(b){"ok"==b.status&&(b.data&&b.data.message&&alert(b.data.message),a.$wrapper.trigger("close"),d.team.calendar.reload())})};return EventDeleteDialog}(jQuery);var Profile=function(d){Profile=function(a){this.$wrapper=a.$wrapper;this.$tabs=this.$wrapper.find(".t-profile-tabs");this.$tabContentPlace=this.$wrapper.find(".t-dynamic-content");this.$calendarPlace=this.$wrapper.find(".t-calendar-place");this.api_enabled=window.history&&window.history.pushState;this.user=a.user||{id:0};this.photo_dialog_url=a.photo_dialog_url;this.is_own_profile=a.is_own_profile||!1;this.wa_app_url=a.wa_app_url||"";this.backend_url=a.backend_url||"";this.wa_url=a.wa_url||"";this.wa_version=
a.wa_version||"";this.oauth_modal=a.oauth_modal||!1;this.webasyst_id_auth_url=a.webasyst_id_auth_url||"";this.xhr=this.is_locked=!1;this.dialogs=[];this.initClass()};Profile.prototype.initClass=function(){this.initEditableJobtitle();this.bindEvents();d.team&&d.team.sidebar&&d.team.sidebar.selectLink(!1);this.is_own_profile&&this.initWebasystIDAuth();this.initWebasystIDShowAccountInfo();this.initWebasystIDUnbindAuth();this.initWebasystIDHelpLink()};Profile.prototype.initWebasystIDShowAccountInfo=function(){var a=
d(".js-show-webasyst-id-account-info"),c=a.parent().find(".js-loading"),b=this.user.id,e=this.wa_app_url||"",f=!1;a.on("click",function(g){g.preventDefault();f||(f=!0,c.show(),d.get(e+"?module=profile&action=waidAccountInfo",{id:b},"html").done(function(a){d(".js-webasyst-id-info-place").replaceWith(a)}).always(function(){f=!1;c.remove();a.remove()}))})};Profile.prototype.initWebasystIDAuth=function(){var a=this,c=function(){window.location=a.webasyst_id_auth_url+"&referrer_url="+window.location.href};
d(document).on("wa_webasyst_id_auth",function(){c()});d(".js-webasyst-id-auth").on("click",function(a){a.preventDefault();c()})};Profile.prototype.initWebasystIDHelpLink=function(){var a=this,c=function(){d.get(a.backend_url+"?module=backend&action=webasystIDHelp",function(a){d("body").append(a)})};d(document).on("wa_waid_help_link",function(){c()});d(".js-webasyst-id-help-link").on("click",function(a){a.preventDefault();c()})};Profile.prototype.initWebasystIDUnbindAuth=function(){var a=this,c=a.user.id||
0,b=a.wa_app_url+"?module=profile&action=waidUnbindConfirm",e=function(){f([{id:"wa-dialog-css",type:"css",uri:a.wa_url+"wa-content/js/dialog/dialog.css?"+a.wa_version},{id:"wa-dialog-js",type:"js",uri:a.wa_url+"wa-content/js/dialog/dialog.js?"+a.wa_version}]);d.get(b,{id:c},function(a){d.waDialog({html:a,onOpen:function(a){var b=a.find(".js-unbind");b.on("click",function(){var e=d('<i class="icon16 loading"></i>');e.insertAfter(b);d.post("?module=profile&action=waidUnbind",{id:c}).always(function(){a.trigger("close");
e.remove();location.reload()})})}})})},f=function(a){var b=d.Deferred();(function(a){function b(a){var b=d.Deferred(),c=b.promise(),e=d("#"+a.id);e.length?c=e.data("promise"):(e=d("<link />",{id:a.id,rel:"stylesheet"}).appendTo("head").data("promise",c),e.on("load",function(){b.resolve(a)}).on("error",function(){b.reject(a)}),e.attr("href",a.uri));return c}function c(a){var b=d.Deferred(),c=b.promise(),e=d("#"+a.id);e.length?c=e.data("promise"):(e=document.createElement("script"),document.getElementsByTagName("head")[0].appendChild(e),
e=d(e).attr("id",a.id).data("promise",c),e.on("load",function(){b.resolve(a)}).on("error",function(){b.reject(a)}),e.attr("src",a.uri));return c}function e(a){--k;g()}function f(a){w.push(a);--k;g()}function g(){0===k&&(w.length?h.reject(w):h.resolve())}var h=d.Deferred(),k=a.length,w=[];d.each(a,function(a,d){switch(d.type){case "css":b(d).then(e,f);break;case "js":c(d).then(e,f)}});return h.promise()})(a).then(function(){b.resolve()},function(a){console&&console.error&&console.error("Error loading resource",
a);b.reject(a)});return b.promise()};d(document).on("wa_waid_unbind_auth",function(a){e()});d(".js-webasyst-id-unbind-auth").on("click",function(){e()})};Profile.prototype.bindEvents=function(){var a=this;a.$tabs.on("click",".t-tab a",function(){a.changeTab(d(this));return!1});a.$calendarPlace.on("click",".js-calendar-toggle",function(b){b.preventDefault();a.calendarToggle(d(this))});a.$calendarPlace.on("click",".js-show-outer-calendar-manager",function(b){b.stopPropagation();a.showOuterDialogDialog()});
a.$wrapper.on("photo_updated photo_deleted",function(b,c){a.$wrapper.find(".t-userpic").attr("src",c.url)});a.$wrapper.find(".photo-change-link a").click(function(){d("#contact-photo-crop-dialog").remove();d('<div id="contact-photo-crop-dialog">').appendTo(a.$wrapper).waDialog({"class":"large",url:a.photo_dialog_url,onLoad:function(a){a=d(this);a.find(".dialog-buttons-gradient").append(a.find(".dialog-content-indent .buttons"))}})});var c=a.$wrapper.find(".profile-header-links");c.on("click",".edit-link",
function(){a.switchToTab("info",function(a){return"function"===typeof a[0].contentWindow.$.wa.contactEditor.switchMode}).then(function(a){a[0].contentWindow.$.wa.contactEditor.switchMode("edit")})});c.on("click",".delete-link",function(){var b=d(this).find("i");b.is(".loading")||(b.toggleClass("delete loading"),d.team.confirmContactDelete([a.user.id],{onInit:function(){b.toggleClass("delete loading")},onDelete:function(){d.team.content.load(d.team.app_url)}}))});var c=a.$wrapper.find(".t-profile-tabs-iframes"),
b=d("#contact-info-top");c.on("contact_saved",function(a,c){var e=b.closest(".t-profile-page").find(".profile .details h1").first();e.children(".contact-name:first").text(c.name);e.children(".title:first").text(c.title);e=e.closest(".details").find(".jobtitle-company");e.children(".company").text(c.company);e.children(".title").text(c.jobtitle)});c.on("top_fields_updated",function(a,c){for(var e="",d=0;d<c.length;d++)var f=c[d],e=e+("<li>"+("im"!=f.id?f.icon?'<i class="icon16 '+f.id+'"></i>':"":"")+
f.value+"</li>");b.html(e)});d("#header-customize-groups-link").click(function(){a.switchToTab("access",function(a){return"function"===typeof a[0].contentWindow.ProfileAccessTab}).then(function(a){a[0].contentWindow.$("#form-customize-groups",a[0].contentWindow.body).is(":not(:visible)")&&a[0].contentWindow.$("#open-customize-groups",a[0].contentWindow.body).click()})})};Profile.prototype.switchToTab=function(a,c){function b(){var k=e.children().filter(function(){return a==d(this).data("tab-id")}).first();
try{k[0].contentWindow&&c(k)&&(setTimeout(function(){g.resolve(k)},0),f.off("tab_content_updated",b),h&&clearInterval(h),h=null)}catch(l){}}var e=this.$wrapper.find(".t-profile-tabs-iframes"),f=this.$wrapper.find('.t-tab a[data-tab-id="'+a+'"]'),g=d.Deferred();f.on("tab_content_updated",b);var h=setInterval(b,100);f.closest(".t-tab").hasClass("is-selected")?b():f.click();f.length&&d("html, body").animate({scrollTop:f.offset().top},500);return g.promise()};Profile.prototype.changeTab=function(a){if(this.api_enabled){a=
a.data("tab-id");var c=window.location.href.match(/^.*\/(id|u)\/[^\/]+/);c&&a&&(a=c[0]+"/"+a+"/",history.replaceState({reload:!0,content_uri:a},"",a))}};Profile.prototype.calendarToggle=function(a){var c=a.find(".t-calendar-toggle .text");this.$calendarPlace.hasClass("is-short")?(c.text(a.data("hide-text")),this.$calendarPlace.removeClass("is-short")):(c.text(a.data("show-text")),this.$calendarPlace.addClass("is-short"))};Profile.prototype.showOuterDialogDialog=function(){function a(){d.post(b,e,
function(b){new TeamDialog({html:b,onRefresh:a})}).always(function(){c.is_locked=!1})}var c=this,b="?module=schedule&action=settings",e={};0<c.user.id&&(b+="&id="+c.user.id);c.is_locked||(c.is_locked=!0,a())};Profile.prototype.initEditableJobtitle=function(){var a=this,c=a.$wrapper.find(".js-jobtitle-editable").first();c.length&&new TeamEditable({$wrapper:c,onSave:function(b){var c=b.$field.val(),f=!c.length;if(b.text!==c){var g=d.team.app_url+"?module=profile&action=save",h={id:a.user.id,data:JSON.stringify({jobtitle:c})};
b.$field.attr("disabled",!0);var k=d('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);d.post(g,h,function(){b.$field.attr("disabled",!1);k.remove();b.is_empty=f;b.text=c;b.$wrapper.text(c);b.toggle("hide");f&&b.$wrapper.parent().find(".at").hide()})}else b.toggle("hide")}})};return Profile}(jQuery),ActivityLazyLoading=function(d){ActivityLazyLoading=function(a){this.list_name=a.names.list;this.items_name=a.names.items;this.pagind_name=a.names.paging;this.user_id=a.user_id;
this.$wrapper=a.$wrapper||!1;this.$list=this.$wrapper.find(this.list_name);this.$window=d(window);this.onLoad=a.onLoad||function(){};this.$paging=this.$wrapper.find(this.pagind_name);this.is_locked=this.xhr=!1;this.addWatcher()};ActivityLazyLoading.prototype.addWatcher=function(){function a(){var e=window&&d.contains(document,c.$paging[0]);e&&b&&window.frameElement&&(e=d.contains(b.document,window.frameElement));if(e)try{c.onScroll()}catch(f){e=!1}e||(c.$window.off("scroll",a),d(b).off("scroll",a))}
var c=this,b=window.parent;c.$window.on("scroll",a);if(b&&window.frameElement)d(b).on("scroll",a)};ActivityLazyLoading.prototype.onScroll=function(){var a=this.$window,c=a.scrollTop(),a=a.height(),b=this.$paging.offset().top;if(window.parent&&window.frameElement)var e=d(window.parent),a=e.height(),c=c+e.scrollTop(),b=b+d(window.frameElement).offset().top;c+a>=b&&!this.is_locked&&(this.is_locked=!0,this.loadNextPage())};ActivityLazyLoading.prototype.loadNextPage=function(){var a=this,c=d.team.app_url+
"?module=profile&action=activity",b={max_id:a.$paging.data("max-id"),id:a.user_id,timestamp:a.$list.find(a.items_name).last().data("timestamp")};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=d.get(c,b,function(b){var c=d(b);b=c.find(a.list_name+" "+a.items_name);c=c.find(a.pagind_name);a.$list.append(b);a.$paging.after(c);a.$paging.remove();a.$paging=c;a.is_locked=!1;a.onLoad()})};return ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=function(d){OutsideCalendarsDialog=function(a){this.$dialogWrapper=
a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$form=this.$wrapper.find("form");this.xhr=this.is_locked=!1;this.initClass()};OutsideCalendarsDialog.prototype.initClass=function(){this.bindEvents()};OutsideCalendarsDialog.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".t-external-calendar-unmount",function(){a.deleteExternalCalendar(d(this).data("id"))});a.$wrapper.find(".js-add-external-calendar").on("click",function(c){c.preventDefault();a.close();(c=
d(this).attr("href"))&&d.team.content.load(c)})};OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(a){d.get("?module=calendarExternal&action=DeleteConfirm",{id:a},function(a){new TeamDialog({html:a,onOpen:function(a){a.bind("afterDelete",function(){d.team.content.reload()})}})})};OutsideCalendarsDialog.prototype.close=function(){this.$wrapper.trigger("close")};return OutsideCalendarsDialog}(jQuery);var AccessPage=function(d){var a=function(b){a=function(a){this.$wrapper=a.$wrapper;this.$accessWrapper=this.$wrapper.find(".t-access-wrapper");this.$accessSlider=this.$wrapper.find(".t-access-slider");this.$headerApps=this.$wrapper.find(".t-header-apps");this.$headerList=this.$headerApps.find(".t-apps-list");this.$apps=this.$headerList.find(".t-app-item");this.item_count=this.$apps.length;this.type_class=!1;this.items_left=this.left=0;this.item_w=this.access_slider_w=this.access_wrapper_w=!1;this.initClass()};
a.prototype.initClass=function(){function a(){b.contains(document,c.$wrapper[0])?c.reset():b(window).off("resize",a)}var c=this;c.detectSliderWidth();c.showArrows();b(window).on("resize",a);c.$wrapper.on("click",".t-action",function(){var a=b(this);a.hasClass("left")&&c.moveSlider(!1);a.hasClass("right")&&c.moveSlider(!0)})};a.prototype.detectSliderWidth=function(){this.access_wrapper_w=this.$accessWrapper.outerWidth();this.access_slider_w=this.$accessSlider.outerWidth();this.item_w=this.$apps.first().outerWidth()};
a.prototype.showArrows=function(){function a(a){b.type_class&&(b.$accessWrapper.removeClass(b.type_class),b.$headerApps.removeClass(b.type_class));a&&(b.$accessWrapper.addClass(a),b.$headerApps.addClass(a),b.type_class=a)}var b=this;0<=b.left?b.access_wrapper_w<b.access_slider_w?a("type-1"):a():b.access_wrapper_w<b.access_slider_w-Math.abs(b.left)?a("type-2"):a("type-3")};a.prototype.setLeft=function(a){this.$headerList.css({left:a});this.$accessSlider.css({left:a});this.left=a};a.prototype.moveSlider=
function(a){var b=this.items_left;a?a=b+1:(a=b-1,0>a&&(a=0));b=a*this.item_w;b>-(this.access_wrapper_w-this.access_slider_w)&&(b=-(this.access_wrapper_w-this.access_slider_w));this.items_left=a;this.setLeft(-b);this.showArrows()};a.prototype.reset=function(){this.items_left=0;this.setLeft(0);this.detectSliderWidth();this.showArrows()};return a}(d),c=function(a){c=function(a){this.$wrapper=a.$wrapper;this.$header=this.$wrapper.find(".t-elastic-header");this.wrapper_offset=this.$wrapper.offset();this.header_w=
this.$header.outerWidth();this.header_h=this.$header.outerHeight();this.fixed_class="is-fixed";this.is_fixed=!1;this.initClass()};c.prototype.initClass=function(){function b(){if(a.contains(document,d.$header[0]))d.onScroll(h.scrollTop());else h.off("scroll",b)}function c(){if(a.contains(document,d.$header[0]))d.onResize();else h.off("resize",c)}var d=this,h=a(window);h.on("scroll",b).on("resize",c)};c.prototype.onScroll=function(a){a>this.wrapper_offset.top?(this.$header.addClass(this.fixed_class).css({top:0,
left:this.wrapper_offset.left,width:this.header_w}),this.is_fixed=!0):(this.$header.removeClass(this.fixed_class).removeAttr("style"),this.is_fixed=!1)};c.prototype.onResize=function(){this.header_w=this.$wrapper.outerWidth();this.is_fixed&&this.$header.width(this.header_w)};return c}(jQuery);AccessPage=function(a){this.$wrapper=a.$wrapper;this.slider=!1;this.dialogs=[];this.initClass()};AccessPage.prototype.initClass=function(){this.initAccessSlider();this.initElasticHeader();this.initHover();this.bindEvents()};
AccessPage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".t-access-status",function(b){b.preventDefault();b=d(this);b.hasClass("is-admin")&&!a.dialogs.length?d.team.content.load(b.data("uri")):showAccessDialog(b,b.data("app-id"),b.data("user-id"))});var c;d(document).on("team_access_level_changed",c=function(b,e){d.contains(document.body,a.$wrapper[0])?a.$wrapper.find('table.t-access-table tr[data-user-id="'+e.contact_id+'"] .t-access-status[data-app-id="'+e.app_id+'"]').removeClass("type-no type-limited type-full type-"+
e.prev_level).addClass("type-"+e.new_level):d(document).off("team_access_level_changed",c)})};AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new a({$wrapper:this.$wrapper}))};AccessPage.prototype.initElasticHeader=function(){new c({$wrapper:this.$wrapper})};AccessPage.prototype.closeDialogs=function(){var a=!1;this.dialogs.length&&(d.each(this.dialogs,function(b,c){d.contains(document,c.$wrapper[0])&&(c.close(),a=!0)}),this.dialogs=[]);return a};AccessPage.prototype.initHover=
function(){function a(){c&&(c.removeClass("highlighted"),c=!1);f&&(f.removeClass("highlighted"),f=!1)}var c=!1,f=!1;this.$wrapper.on("mouseenter",".t-access-status",function(){var b=d(this),e=b.data("user-id"),b=b.data("app-id");a();e&&b&&(e=d("#t-user-"+e),b=d("#t-app-"+b),e.length&&(e.addClass("highlighted"),c=e),b.length&&(b.addClass("highlighted"),f=b))});this.$wrapper.on("mouseleave",".t-access-status",a)};return AccessPage}(jQuery);
(function(d){window.AccessDialog=function(a){function c(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$limitedContent=this.$wrapper.find(".t-limited-access-form");this.active_class="is-active";this.disabled_class="is-disabled";this.wa_app_url=a.wa_app_url;this.app_id=a.app_id;this.contact_id=a.contact_id;this.teamDialog=this.$dialogWrapper.data("teamDialog")||!1;this.noticeToggle=b(this.$wrapper);this.$activeTab=this.$wrapper.find(".t-access-item."+
this.active_class);this.active_access_id=this.$activeTab.data("access-id");this.is_locked=!1;this.initClass()}function b(b){var c=b.find(".t-loading"),d=b.find(".t-success"),e,k;return e={loading:function(){d.removeClass("is-visible");c.addClass("is-visible")},success:function(){d.addClass("is-visible");c.removeClass("is-visible");k&&clearTimeout(k);k=setTimeout(function(){a.contains(document,d[0])&&e.hide()},2E3)},hide:function(){k&&clearTimeout(k);c.removeClass("is-visible");d.removeClass("is-visible")}}}
c.prototype.initClass=function(){this.bindEvents()};c.prototype.bindEvents=function(){var b=this;b.$wrapper.on("click",".t-access-item",function(){var c=a(this),d=c.hasClass(b.active_class),e=c.hasClass(b.disabled_class);b.is_locked||d||e?e&&alert(c.data("reason-disabled")):(b.changeTab(c),b.teamDialog&&b.teamDialog.resize())});b.$wrapper.on("click",'input[type="submit"]',function(a){a.stopPropagation();b.save()})};c.prototype.changeTab=function(a){var b=a.data("access-id"),c=this.$limitedContent;
this.$activeTab.length&&this.$activeTab.removeClass(this.active_class);a.addClass(this.active_class);this.$activeTab=a;this.$wrapper.find(".t-hint").hide();"no"==b?this.$wrapper.find(".t-hint.js-access-no").show():"full"==b&&this.$wrapper.find(".t-hint.js-access-full").show();this.$limitedContent.length&&("limited"==b?c.show():c.hide())};c.prototype.save=function(){var b=this,c=b.$activeTab.data("access-id"),d=function(a){var b=!1,c={no:0,limited:1,full:2};c.hasOwnProperty(a)&&(b=c[a]);return b}(c);
b.is_locked=!0;b.noticeToggle.loading();d=a.post(b.wa_app_url+"?module=accessSave&action=rights&id="+b.contact_id,{app_id:b.app_id,name:"backend",value:d},"json");"limited"==c&&(d=d.then(function(){var c=b.$limitedContent.find("form");return a.post(c.attr("action"),c.serialize(),"json")}));d.then(function(){var d=b.active_access_id;a(document).trigger("team_access_level_changed",{app_id:b.app_id,contact_id:b.contact_id,prev_level:d,new_level:c});b.active_access_id=c;b.noticeToggle.success();b.is_locked=
!1;b.teamDialog.close()})};return c}(d);window.ProfileAccessTab=function(a){function c(){d(".js-webasyst-id-auth").on("click",function(a){a.preventDefault();window.top.$("body").trigger("wa_webasyst_id_auth")})}function b(a,c){if(d.fn.iButton)var e=d(".basic-user-fields"),f=d("#c-access-link-block").click(function(){if(!confirm(f.data("alert")))return!1;d(".c-shown-on-enabled").hide();var a=m.parent().find(".loading").show();d.post(h+"?module=accessSave&action=ban&id="+g,{magic_word:"please"},function(b){a.hide();
"ok"===b.status&&(e.addClass("gray"),d(".c-shown-on-disabled").show(),d("#tc-user-access-disabled").show().html(b.data.access_disable_msg))},"json")}),m=d("#c-access-link-unblock").click(function(){if(!confirm(m.data("alert")))return!1;d(".c-shown-on-disabled").hide();var a=m.parent().find(".loading").show();d.post(h+"?module=accessSave&action=unban&id="+g,{magic_word:"please"},function(){a.hide();e.removeClass("gray");d(".c-shown-on-enabled").show();d("#tc-user-access-disabled").hide().html("")})});
else d.ajax({cache:!0,dataType:"script",url:a+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+c,success:function(){b(a,c)}})}var e=a.login,f=a.password,g=a.contact_id,h=a.wa_app_url,k=a.url_change_api_token,l=a.loc;(function(){var a=d("#form-customize-groups");a.length&&(function(a){function b(a,b){var c=d(b||this);c.prop("checked")?c.parent().addClass("highlighted"):c.parent().removeClass("highlighted")}a.find('input[type="checkbox"]').click(b).each(b);return a}(d("#form-customize-groups .c-checkbox-menu")),
d("#open-customize-groups").click(function(){d("#form-customize-groups").toggle()}),d("#cancel-customize-groups").click(function(){var a=d("#form-customize-groups").hide();a.find(".loading").hide();a.find(".errormsg").remove();return!1}),a.submit(function(){var a=d(this);a.find(".errormsg").remove();a.find(".loading").show();d.post(a.attr("action"),a.serialize(),function(b){if("ok"==b.status){try{window.parent.$.team.sidebar.reload()}catch(v){}window.hasOwnProperty("profileTab")&&window.profileTab.reload()}else"fail"==
b.status&&a.find(".c-checkbox-menu-container").after(d('<em class="errormsg">'+b.errors.join("<br />")+"</em>"))},"json");return!1}))})();(function(){d("#c-credentials-form").submit(function(){var a=d(this);a.find("input.error").removeClass("error");a.find(".errormsg").remove();var b=a.find(".c-login-input"),c=d.trim(b.val());if(!c)return b.addClass("error").after('<em class="errormsg">'+l["Login is required"]+"</em>"),!1;d.post(a.attr("action"),a.serialize(),function(b){if("ok"===b.status){a.hide();
e=c;d("#c-login-block").show().find(".c-login-input").val(e).end().find(".c-login").text(e);try{window.parent.$.team.sidebar.reload()}catch(x){}try{window.profileTab.reload()}catch(x){}}else"fail"===b.status&&a.find('input[type="submit"]').parent().prepend(d('<em class="errormsg" style="margin-bottom:10px">'+b.errors.join("<br>")+"</em>"))},"json");return!1}).find(".cancel").click(function(){d("#c-credentials-block").hide();return!1})})();(function(){var a=d("#c-login-form"),b=a.find(".c-login-input");
a.submit(function(){a.find("input.error").removeClass("error");a.find(".errormsg").remove();var c=d.trim(b.val());if(e===c)return!1;if(!c)return b.addClass("error").after('<em class="errormsg">'+l["Login is required."]+"</em>"),!1;a.find(".loading").show();d.post(a.attr("action"),a.serialize(),function(f){a.find(".loading").hide();if("ok"===f.status){d("#c-login-block").show();b.val(c);a.find(".c-login").text(c);a.find(".c-one-tab").show();a.find(".c-two-tab").hide();if(!e)try{window.profileTab.reload()}catch(x){}e=
c}else"fail"===f.status&&a.find('input[type="submit"]').parent().prepend(d('<em class="errormsg" style="margin-bottom:10px">'+f.errors.join("\n<br>\n")+"</em>"))},"json");return!1});a.find(".c-tab-toggle").click(function(){a.find(".c-one-tab,.c-two-tab").toggle();b.is(":visible")&&b.focus();return!1})})();(function(){var a=d("#c-password-form"),b=a.find(".c-password-input"),c=a.find(".c-confirm-password-input");a.submit(function(){a.find("input.error").removeClass("error");a.find(".errormsg").remove();
if(b.val()!==c.val())return b.addClass("error"),c.after().after('<em class="errormsg">'+l["Passwords do not match."]+"</em>"),!1;a.find(".loading").show();d.post(a.attr("action"),a.serialize(),function(e){a.find(".loading").hide();"ok"===e.status?(f=!0,b.val(""),c.val(""),a.find(".c-one-tab").show(),a.find(".c-two-tab").hide(),d("#c-password-block").show()):"fail"===e.status&&c.after('<em class="errormsg">'+e.errors.join("<br />")+"</em>")},"json");return!1});a.find(".c-tab-toggle").click(function(){a.find(".c-one-tab,.c-two-tab").toggle();
var b=a.find(".c-password-input");b.is(":visible")&&b.focus();return!1})})();(function(){var a=d("#tc-api-tokens-filed"),b=a.find(".js-api-tokens-list"),c=!1;a.on("click",".js-remove-api-token",function(e){e.preventDefault();var f=d(this).parents(".js-token-item"),g=f.find(".icon16");e=f.data("token");var h={action:"remove",token_id:e};!c&&e&&confirm(l.remove_ask)&&(c=!0,g.removeClass("no").addClass("loading"),d.post(k,h,function(d){d.status&&"ok"===d.status?(f.remove(),0===b.find(".js-token-item").length&&
a.remove()):(c=!1,g.removeClass("loading").addClass("no"))}).always(function(){c=!1;g.removeClass("loading").addClass("no")}))})})();a.is_own_profile||b(a.wa_url,a.wa_framework_version);a.is_own_profile&&c();(function(a){d(".js-show-webasyst-id-account-info").on("click",function(b){b.preventDefault();var c=d(this),e=c.parent().find(".js-loading");e.show();d.get("{$wa_app_url}?module=profile&action=waidAccountInfo",{id:a},"html").done(function(a){d(".js-webasyst-id-info-place").replaceWith(a)}).always(function(){e.remove();
c.remove()})})})(g);(function(){d(".js-webasyst-id-unbind-auth").on("click",function(a){a.preventDefault();window.top.$(".js-webasyst-id-unbind-auth").trigger("wa_waid_unbind_auth")})})();(function(){d(".js-webasyst-id-help-link").on("click",function(a){a.preventDefault();window.top.$("body").trigger("wa_waid_help_link")})})();(function(a,b,c){function k(){l()&&m()}function l(){d("#c-access-rights-hint-warning").hide();d("#c-access-rights-hint-customize").hide();var b=n.val();void 0===b&&(b="1");
switch(b){case "remove":d("#c-credentials-block").hide();d("#c-login-block").hide();d("#c-password-block").hide();if(c){d("#c-access-rights-by-app").hide();d(".c-shown-on-access").hide();break}n.val(r||"0");d("#c-access-rights-hint-warning").show();return!1;case "0":if(e||f)if(e){d("#c-access-rights-by-app").show();d(".c-shown-on-access").show();d("#c-login-block").show();d("#c-password-block").show();break}else return d("#c-login-block").show().find(".cancel").one("click.access",function(){n.val(r);
k()}).end().find(".c-tab-toggle:first").click(),d("#c-password-block").show(),!1;else return d("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){n.val(r);k()}),!1;case "1":if(e||f)if(e){d("#c-access-rights-by-app").hide();d(".c-shown-on-access").show();d("#c-login-block").show();d("#c-password-block").show();break}else return d("#c-login-block").show().find(".cancel").one("click.access",function(){n.val(r);k()}).end().find(".c-tab-toggle:first").click(),
d("#c-password-block").show(),!1;else return d("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){n.val(r);k()}),!1;default:return!1}a&&(d("#c-login-block").show(),d("#c-password-block").show());r=b;return!0}function m(){function a(a,b,c){return d.post(h+"?module=accessSave&action=rights&id="+g,{app_id:a,name:b,value:c},"json")}var b=n.val();void 0===b&&(b="1");(function(){switch(b){case "0":return d.post(h+"?module=accessSave&action=makeuser",
{id:g},"json").then(function(){return a("webasyst","backend",0)});case "1":return a("webasyst","backend",1);case "remove":return d.post(h+"?module=accessSave&action=revoke",{id:g},"json")}})().then(function(){c&&"0"==b?d("#c-access-rights-hint-customize").show():d("#c-access-rights-hint-warning").hide()})}var n=d("#c-access-rights-toggle"),q=d("#access-rights-toggle-confirm"),r=n.val();b?d(".c-shown-on-access").hide():d(".c-shown-on-access").show();l();q.on("click",".cancel",function(){n.val(r);q.hide()});
q.on("click",".button",function(){q.hide();k()});n.change(function(){if(e){d("#c-access-rights-hint-warning").hide();d("#c-access-rights-hint-customize").hide();var a=n.val();void 0===a&&(a="1");a===r?q.hide():q.show()}else l()})})(a.is_own_profile,a.contact_no_access,a.contact_groups_no_access);new UserAccessTable({$wrapper:d("#c-access-rights-wrapper"),contact_id:g,is_frame:!0})};window.UserAccessTable=function(a){var c=a.$wrapper,b=a.contact_id,e=a.is_frame||!1;c.on("click",".t-access-status",
function(a){a.preventDefault();a=d(this);showAccessDialog(a,a.data("app-id"),b,!0,e)});var f;d(document).on("team_access_level_changed",f=function(a,b){d.contains(document.body,c[0])?c.find('.t-access-status[data-app-id="'+b.app_id+'"]').removeClass("type-no type-limited type-full type-"+b.prev_level).addClass("type-"+b.new_level):d(document).off("team_access_level_changed",f)})};window.showAccessDialog=function(a,c,b,e,f){a.trigger("close");d.post(d.team.app_url+"?module=access&action=dialog",{user_id:b,
app_id:c},function(b){b={html:b};f&&e&&(b.setPosition=function(b){var c=d(window).width();return{top:a.offset().top,left:parseInt((c-b.width)/2)}});new TeamDialog(b)})}})(jQuery);var GroupPage=function(d){GroupPage=function(a){this.$wrapper=a.$wrapper;this.group_id=a.group_id;this.map_adapter=a.map_adapter;this.latitude=a.latitude;this.longitude=a.longitude;this.can_manage=a.can_manage;this.map_is_shown=this.map_is_render=!1;this.initClass()};GroupPage.prototype.initClass=function(){this.bindEvents();this.can_manage&&(this.initEditableName(),this.initEditableDescription());this.initInfoBlock()};GroupPage.prototype.bindEvents=function(){var a=this;if(a.map_adapter&&a.latitude&&
a.longitude)a.$wrapper.on("click",".js-open-map-link",function(){a.showMap()})};GroupPage.prototype.showMap=function(){var a=this.$wrapper.find(".t-map-wrapper");this.map_is_shown?a.slideUp(200):this.map_is_render?a.slideDown(200):(a.show(),this.initMap(),this.map_is_render=!0);this.map_is_shown=!this.map_is_shown};GroupPage.prototype.initMap=function(){var a=this.$wrapper.find("#t-location-map");(new TeamMap(a,this.map_adapter)).render(this.latitude,this.longitude)};GroupPage.prototype.initEditableName=
function(){var a=this,c=a.$wrapper.find(".js-name-editable").first();c.length&&new TeamEditable({$wrapper:c,onSave:function(b){var c=b.$field.val();if(c.length&&b.text!==c){var f=d.team.app_url+"?module=group&action=save",g={"data[id]":a.group_id,"data[name]":c};b.$field.attr("disabled",!0);var h=d('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);d.post(f,g,function(){b.$field.attr("disabled",!1);h.remove();b.text=c;b.$wrapper.text(c);b.toggle("hide");d.team.sidebar.reload()})}else c.length||
b.$field.val(b.text),b.toggle("hide")}})};GroupPage.prototype.initEditableDescription=function(){var a=this,c=a.$wrapper.find(".js-desc-editable").first();c.length&&new TeamEditable({$wrapper:c,onSave:function(b){var c=b.$field.val(),f=!c.length;if(b.text!==c){var g=d.team.app_url+"?module=group&action=save",h={"data[id]":a.group_id,"data[description]":c};b.$field.attr("disabled",!0);var k=d('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);d.post(g,h,function(){b.$field.attr("disabled",
!1);k.remove();b.is_empty=f;b.text=c;b.$wrapper.text(c);b.toggle("hide");f&&d.team.content.reload()})}else b.toggle("hide")}})};GroupPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),c=new d.store;c.get("team/empty_group_notice_hide")?a.hide():a.show();a.find(".t-info-notice-toggle").on("click",function(){c.set("team/empty_group_notice_hide",1);a.hide()})};return GroupPage}(jQuery),GroupManage=function(d){GroupManage=function(a){this.$wrapper=a.$wrapper;this.$groupUsersW=
this.$wrapper.find(".t-users-list.is-used-list");this.$groupUsersHint=this.$wrapper.find(".t-empty-users-in-group");this.$otherUsersW=this.$wrapper.find(".t-users-list.is-unused-list");this.$otherUsersHint=this.$wrapper.find(".t-empty-users-outside-group");this.group_id=a.group_id;this.hidden_class="is-hidden";this.locales=a.locales;this.xhr=this.is_locked=this.$sidebarLink=!1;this.group_count=this.$groupUsersW.find(".t-user-wrapper").length;this.other_count=this.$otherUsersW.find(".t-user-wrapper").length;
this.initClass()};GroupManage.prototype.initClass=function(){this.bindEvents();this.initAutoComplete();this.initEditableName()};GroupManage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-edit-group",function(c){c.preventDefault();a.group_id&&!a.is_locked&&a.showEditGroupDialog()});a.$wrapper.on("click",".js-delete-group",function(c){c.preventDefault();a.group_id&&!a.is_locked&&a.showDeleteDialog()});a.$groupUsersW.on("click",".js-move-user",function(c){c.preventDefault();a.is_locked||
a.moveUser(d(this).closest(".t-user-wrapper"),!1)});a.$otherUsersW.on("click",".js-move-user",function(c){c.preventDefault();a.is_locked||a.moveUser(d(this).closest(".t-user-wrapper"),!0)})};GroupManage.prototype.showEditGroupDialog=function(){var a=this,c={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=d.get("?module=group&action=edit",c,function(b){new TeamDialog({html:b});a.is_locked=!1}))};GroupManage.prototype.showDeleteDialog=function(){var a=this,c=d.team.app_url+
"?module=group&action=deleteConfirm",b={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=d.get(c,b,function(b){new TeamDialog({html:b});a.is_locked=!1;a.$wrapper.trigger("close")}))};GroupManage.prototype.moveUser=function(a,c){var b=this,e={user_id:a.data("user-id"),group_id:b.group_id},f;b.is_locked||(b.xhr&&(b.xhr.abort(),b.xhr=!1),f=c?d.team.app_url+"?module=group&action=userAdd":d.team.app_url+"?module=group&action=userRemove",b.xhr=d.post(f,e,function(d){"ok"==
d.status&&(c?(b.$groupUsersW.append(a),b.group_count++,b.other_count--):(b.$otherUsersW.prepend(a),b.group_count--,b.other_count++),0>=b.group_count?(b.$groupUsersW.addClass(b.hidden_class),b.$groupUsersHint.removeClass(b.hidden_class)):(b.$groupUsersW.removeClass(b.hidden_class),b.$groupUsersHint.addClass(b.hidden_class)),0>=b.other_count?(b.$otherUsersW.addClass(b.hidden_class),b.$otherUsersHint.removeClass(b.hidden_class)):(b.$otherUsersW.removeClass(b.hidden_class),b.$otherUsersHint.addClass(b.hidden_class)),
b.setCount(b.group_count));b.is_locked=!1}))};GroupManage.prototype.setCount=function(a){var c=d.team.app_url+"group/"+this.group_id+"/";this.$sidebarLink||(this.$sidebarLink=d.team.sidebar.$wrapper.find('a[href="'+c+'"] '));if(this.$sidebarLink.length){var b=this.$sidebarLink.closest("li");b.find(".indicator").remove();b.find(".count").text(a);d.team.sidebar.saveCount(c,a)}};GroupManage.prototype.initAutoComplete=function(){function a(){clearTimeout(g);f.length&&(f.remove(),f=!1)}function c(b){f=
d('<span class="t-hint"><i class="icon16 yes"></i>'+b+"</span>");e.after(f);g=setTimeout(a,1E3)}var b=this,e=b.$wrapper.find(".t-autocomplete-wrapper .t-input"),f=!1,g=0;e.autocomplete({source:function(a,c){var e=d.team.app_url+"?module=autocomplete&type=user",f={term:a.term};b.group_id&&(f.group_id=b.group_id);d.post(e,f,function(a){c(a)},"json")},minLength:2,open:function(){a()},focus:function(){return!1},select:function(a,d){if(d.item.id){var f=b.$otherUsersW.find('.t-user-wrapper[data-user-id="'+
d.item.id+'"]');f.length?(f.find(".js-move-user").click(),c(b.locales.added)):c(b.locales.in_group)}e.val("");return!1}})};GroupManage.prototype.initEditableName=function(){var a=this,c=a.$wrapper.find(".js-name-editable").first();c.length&&new TeamEditable({$wrapper:c,onSave:function(b){var c=b.$field.val();if(c.length&&b.text!==c){var f=d.team.app_url+"?module=group&action=save",g={"data[id]":a.group_id,"data[name]":c};b.$field.attr("disabled",!0);var h=d('<i class="icon16 loading"></i>').css("margin",
"0 0 0 4px").insertAfter(b.$field);d.post(f,g,function(){b.$field.attr("disabled",!1);h.remove();b.text=c;b.$wrapper.text(c);b.toggle("hide");d.team.sidebar.reload()})}else c.length||b.$field.val(b.text),b.toggle("hide")}})};return GroupManage}(jQuery),GroupEditDialog=function(d){GroupEditDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$form=this.$block.find("form");this.$iconToggle=this.$block.find(".t-icon-toggle");this.$addressToggle=this.$block.find(".t-address-toggle");
this.$mapToggle=this.$block.find(".t-map-toggle");this.$submitButton=this.$form.find('input[type="submit"]');this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="error";this.locales=a.locales;this.dialog=this.$wrapper.data("teamDialog");this.$activeType=this.$block.find(".t-type-toggle ."+this.selected_class);this.$activeIcon=this.$iconToggle.find("."+this.selected_class);this.is_locked=!1;this.save_timeout=0;this.is_map_loading=!1;this.bindEvents();this.teamMap=this.initMap(a.map_type||
"google")};GroupEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".t-type-toggle .t-toggle-item",function(c){c.stopPropagation();a.setType(d(this))});a.$iconToggle.on("click",".t-icon-item",function(c){c.preventDefault();a.setIcon(d(this))});a.$form.on("submit",function(c){c.preventDefault();a.is_locked||(a.$form.find(".js-submit-loading").remove(),a.$submitButton.parent().append("<i class='icon16 loading js-submit-loading'></i>"),a.save())});a.$form.find("input, textarea").on("mousedown",
function(){var c=d(this),b=c.hasClass(a.has_error_class);a.$form.find(".js-submit-loading").remove();b&&c.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()})};GroupEditDialog.prototype.setType=function(a){var c=a.data("type");if(a.hasClass(this.selected_class))return!1;this.$activeType.length&&this.$activeType.removeClass(this.selected_class);"group"==c?(this.$iconToggle.removeClass(this.hidden_class),this.$addressToggle.addClass(this.hidden_class),this.$mapToggle.addClass(this.hidden_class)):
(this.$iconToggle.addClass(this.hidden_class),this.$addressToggle.removeClass(this.hidden_class),this.$mapToggle.removeClass(this.hidden_class));a.addClass(this.selected_class);this.$activeType=a;this.dialog.resize()};GroupEditDialog.prototype.setIcon=function(a){var c=a.data("icon-class");if(a.hasClass(this.selected_class))return!1;this.$activeIcon.length&&this.$activeIcon.removeClass(this.selected_class);this.$form.find('input[name="data[icon]"]').val(c).trigger("change");a.addClass(this.selected_class);
this.$activeIcon=a};GroupEditDialog.prototype.save=function(a){function c(a){function c(a){b.$form.find(".t-error").remove();d.each(a,function(a,c){var d=b.$form.find("[name='"+c.field+"']");d.length&&d.addClass(b.has_error_class).after('<span class="t-error">'+b.locales[c.locale]+"</span>")})}var e={},f=[];d.each(a,function(a,b){e[b.name]=b.value});d.trim(e["data[name]"]).length||f.push({field:"data[name]",locale:"empty"});return f.length?(c(f),!1):e}var b=this,e;a=a||0;if(!b.is_locked)if(b.is_locked=
!0,e=c(b.$form.serializeArray())){if(b.is_map_loading&&5>a)return b.is_locked=!1,b.save_timeout=setTimeout(function(){d.contains(document,b.$wrapper[0])&&b.save(a+1)},1E3),!1;var f=function(){d.post("?module=group&action=save",e,function(a){"ok"==a.status&&(d.team.content.load(d.team.app_url+"group/"+a.data.id+"/manage/"),d.team.sidebar.reload(),b.is_locked=!1)})},g=e["data[location][address]"],h=e["data[location][latitude]"],k=e["data[location][longitude]"];!g||h&&k||!b.teamMap?f():b.teamMap.geocode(g,
function(a,b){e["data[location][latitude]"]=a;e["data[location][longitude]"]=b;f()},function(){f()})}else b.is_locked=!1};GroupEditDialog.prototype.initMap=function(a){function c(a){function c(a,b){k.is(":hidden")&&(k.show(),e.data("top",e.offset().top),e.css("top",e.data("top")-k.height()/2));n.render(a,b);h.val(a);g.val(b)}clearTimeout(m);"string"===d.type(a)?(b.is_map_loading=!0,n.geocode(a,function(a,d){h.val(a);g.val(d);l.hide();c(a,d);b.is_map_loading=!1},function(){k.hide();g.val("");h.val("");
l.show();b.is_map_loading=!1})):c(a.lat,a.lng)}var b=this,e=b.$block,f=b.$addressToggle.find(".f-location-edit-address-input"),g=b.$addressToggle.find(".t-location-longitude-input"),h=b.$addressToggle.find(".t-location-latitude-input"),k=b.$mapToggle.find(".t-location-edit-map"),l=b.$addressToggle.find(".t-map-hint"),m=0,n;if(0<f.length){var q=b.$form.find(".value").first().width();k.width(q);k.height(q/1.618)}n=new TeamMap(k,a);a=g.val();q=h.val();a&&q&&c({lat:q,lng:a});f.on("change",function(){var a=
d(this).val();a.length?c(a):(g.val(""),h.val(""),k.hide())});f.on("keyup",function(){clearTimeout(m);var a=d(this).val();a.length?(b.is_map_loading=!0,m=setTimeout(function(){c(a)},1E3)):(g.val(""),h.val(""),k.hide())});return n};return GroupEditDialog}(jQuery),GroupDeleteDialog=function(d){GroupDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.api_enabled=window.history&&window.history.replaceState;this.group_id=a.group_id;this.is_locked=!1;
this.initClass()};GroupDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(c){c.preventDefault();if(!a.is_locked)a["delete"]()})};GroupDeleteDialog.prototype["delete"]=function(){var a=this,c={id:a.group_id};a.is_locked=!0;d.post("?module=group&action=delete",c,function(b){"ok"==b.status&&(a.$wrapper.trigger("close"),a.api_enabled?(history.state.content_uri=d.team.app_url,history.replaceState({reload:!0,content_uri:d.team.app_url},"",d.team.app_url),
d.team.sidebar.reload(),d.team.content.reload()):location.href=d.team.app_url)},"json")};return GroupDeleteDialog}(jQuery);var SettingsPage=function(d){SettingsPage=function(a){this.$wrapper=a.$wrapper;this.$calendarToggle=this.$wrapper.find("#t-calendar-settings");this.$form=this.$wrapper.find("form");this.$submitButton=this.$form.find('input[type="submit"]');this.locales=a.locales;this.xhr=this.is_form_changed=this.is_locked=this.$notice=!1;this.initClass()};SettingsPage.prototype.initClass=function(){this.bindEvents();this.initSortable()};SettingsPage.prototype.bindEvents=function(){var a=this;a.$calendarToggle.on("click",
".js-edit-calendar",function(c){c.preventDefault();(c=parseInt(d(this).closest(".t-calendar-item").data("id")))&&a.showEditDialog(c)});a.$calendarToggle.on("click",".js-add-calendar",function(c){c.preventDefault();a.showEditDialog()});a.$form.on("submit",function(c){c.preventDefault();a.is_form_changed&&a.save(a.$form)});a.$form.on("change","input, select, textarea",function(){a.is_form_changed||(a.is_form_changed=!0,a.$submitButton.removeClass("green").addClass("yellow"))})};SettingsPage.prototype.initSortable=
function(){var a=this,c;a.$calendarToggle.find("ul").sortable({handle:".t-toggle",items:"> .t-calendar-item",axis:"y",start:function(b,d){c=d.item.index();a.$notice&&(a.$notice.remove(),a.$notice=!1)},stop:function(b,d){c!=d.item.index()&&a.saveCalendarsSort(d)}})};SettingsPage.prototype.showEditDialog=function(a){var c=this,b=d.team.app_url+"?module=calendar",e={};a&&(e.id=a);c.xhr&&(c.xhr.abort(),c.xhr=!1);c.xhr=d.post(b,e,function(a){c.dialog=new TeamDialog({html:a})})};SettingsPage.prototype.saveCalendarsSort=
function(a){function c(a){var c=d('<span class="t-notice"><i class="icon16 yes"></i>'+(b.locales.saved||"")+"</span>");c.appendTo(a);return c}var b=this,e=a.item;a=d.team.app_url+"?module=settings&action=calendarsSortSave";var f={calendars:function(){var a=[];b.$calendarToggle.find(".t-calendar-item").each(function(){var b=d(this).data("id");b&&0<b&&a.push(b)});return a}()};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.$notice=function(a){var c=d('<span class="t-notice"><i class="icon16 loading"></i>'+(b.locales.saving||
"")+"</span>");c.appendTo(a);return c}(e);b.xhr=d.post(a,f,function(a){b.$notice.remove();b.$notice=c(e);setTimeout(function(){b.$notice&&d.contains(document,b.$notice[0])&&b.$notice.remove()},1E3);b.xhr=!1})};SettingsPage.prototype.save=function(a){var c=this,b=d.team.app_url+"?module=settings&action=save";a=a.serializeArray();var e=d('<i class="icon16 loading" style="margin: 0 4px;"></i>');e.insertAfter(c.$submitButton);c.is_locked||(c.is_locked=!0,d.post(b,a,function(a){c.is_form_changed=!1;c.$submitButton.removeClass("yellow").addClass("green");
"ok"===a.status&&("google"===a.data.map_info.adapter?d.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&key="+(a.data.map_info.settings.key||"")+"&lang="+a.data.lang):"yandex"===a.data.map_info.adapter&&d.getScript("https://api-maps.yandex.ru/2.1/?lang="+a.data.lang))}).always(function(){e.remove();c.is_locked=!1}))};return SettingsPage}(jQuery),CalendarEditDialog=function(d){CalendarEditDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$form=
this.$block.find("form");this.$styleWrapper=this.$block.find(".t-style-wrapper");this.$limitedToggle=this.$block.find(".t-limited-toggle");this.$nameField=this.$block.find('input[name="data[name]"]');this.calendar_id=a.calendar_id;this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="error";this.locales=a.locales;this.teamDialog=this.$wrapper.data("teamDialog");this.$selectedStyleButton=this.$styleWrapper.find("."+this.selected_class);this.xhr=this.is_locked=!1;this.initClass()};
CalendarEditDialog.prototype.initClass=function(){this.bindEvents();this.initColorPicker()};CalendarEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".js-delete-calendar",function(c){c.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$styleWrapper.on("click",".t-style-item",function(c){c.preventDefault();a.setStyleToggle(d(this))});a.$form.on("submit",function(c){c.preventDefault();a.locked||a.save()});a.$form.on("change",".t-color-field",function(){a.$selectedStyleButton.length&&
(a.$selectedStyleButton.removeClass(a.selected_class),a.$selectedStyleButton=!1)});a.$form.find("input, textarea").on("mousedown",function(){var c=d(this);c.hasClass(a.has_error_class)&&c.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()});a.$nameField.on("change keyup",function(){var c=d(this).val(),c=c.length?c:a.locales.preview;a.setPreviewName(c)});a.$limitedToggle.on("change","input:radio",function(){var c=a.$limitedToggle.find(".t-hidden-content");d(this).val().length?
c.show():c.hide();a.teamDialog.resize()})};CalendarEditDialog.prototype.setStyleToggle=function(a){var c=a.css("background-color"),b=a.css("color");this.$selectedStyleButton.length&&this.$selectedStyleButton.removeClass(this.selected_class);this.setStyleData(c,b);a.addClass(this.selected_class);this.$selectedStyleButton=a};CalendarEditDialog.prototype.setStyleData=function(a,c){function b(a){a=a.split("(")[1].split(")")[0];a=a.split(",").splice(0,3);return"#"+a.map(function(a){a=parseInt(a).toString(16);
return 1==a.length?"0"+a:a}).join("")}a=b(a);c=b(c);this.$form.find('[name="data[bg_color]"]').val(a).trigger("change");this.$form.find('[name="data[font_color]"]').val(c).trigger("change")};CalendarEditDialog.prototype.showDeleteConfirm=function(){var a=this,c={id:a.calendar_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=d.get("?module=calendar&action=deleteConfirm",c,function(b){new TeamDialog({html:b});a.is_locked=!1;a.$wrapper.trigger("close")})};CalendarEditDialog.prototype.initColorPicker=
function(){var a=this,c=function(b){c=function(a){this.$wrapper=a.$wrapper;this.$field=this.$wrapper.find(".t-color-field");this.$icon=this.$wrapper.find(".js-show-color-picker");this.$colorPicker=this.$wrapper.find(".t-color-picker");this.farbtastic=this.is_opened=!1;this.initClass()};c.prototype.initClass=function(){var a=this;a.farbtastic=b.farbtastic(a.$colorPicker,function(b){a.$field.val(b).change()});a.$wrapper.data("colorPicker",a);a.bindEvents()};c.prototype.bindEvents=function(){function c(){d.$wrapper.siblings().each(function(){var a=
b(this).data("colorPicker");a&&a.is_opened&&a.displayToggle(!1)})}var d=this;d.$field.on("change keyup",function(){var a=b(this).val();d.$icon.css("background-color",a);d.farbtastic.setColor(a)});d.$icon.on("click",function(a){a.preventDefault();c();d.displayToggle(!d.is_opened)});d.$wrapper.on("click",function(a){a.preventDefault();a.stopPropagation()});d.$field.on("focus",function(){d.is_opened||(c(),d.displayToggle(!0))});a.$wrapper.find(".t-dialog-background").on("click",function(){d.is_opened&&
d.displayToggle(!1)});a.$block.on("click",function(){d.is_opened&&d.displayToggle(!1)})};c.prototype.displayToggle=function(a){var b=this.$colorPicker;a?(b.removeClass("is-hidden"),this.is_opened=!0):(b.addClass("is-hidden"),this.is_opened=!1)};return c}(jQuery);a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new c({$wrapper:d(this)})})};CalendarEditDialog.prototype.setPreviewName=function(a){this.$styleWrapper.find(".t-style-item").text(a)};CalendarEditDialog.prototype.save=function(){var a=
this,c=function(b){function c(b){a.$form.find(".t-error").remove();d.each(b,function(b,c){var d=a.$form.find("[name='"+c.field+"']");d.length&&d.addClass(a.has_error_class).after('<span class="t-error">'+a.locales[c.locale]+"</span>")})}var f={},g=[];d.each(b,function(a,b){f[b.name]=b.value});f["data[is_limited]"]||delete f["data[is_limited]"];d.trim(f["data[name]"]).length||g.push({field:"data[name]",locale:"empty"});return g.length?(c(g),!1):f}(a.$form.serializeArray());a.is_locked||(a.is_locked=
!0,c?d.post("?module=calendar&action=save",c,function(b){"ok"==b.status&&(d.team.content.reload(),d.team.sidebar.reload(),a.is_locked=!1)}):a.is_locked=!1)};return CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(d){CalendarDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.calendar_id=a.calendar_id;this.is_locked=!1;this.initClass()};CalendarDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-calendar",
function(c){c.preventDefault();if(!a.is_locked)a["delete"]()})};CalendarDeleteDialog.prototype["delete"]=function(){var a=this,c={id:a.calendar_id};a.is_locked=!0;d.post("?module=calendar&action=delete",c,function(b){"ok"==b.status&&(d.team.content.reload(),a.$wrapper.trigger("close"))},"json")};return CalendarDeleteDialog}(jQuery);var SiteApiTokenPage=function(d){SiteApiTokenPage=function(a){this.$wrapper=a.$wrapper;this.locale=a.locale;this.initClass()};SiteApiTokenPage.prototype.initClass=function(){this.initRemoveApiToken()};SiteApiTokenPage.prototype.initRemoveApiToken=function(){var a=this,c=a.$wrapper.find(".js-api-tokens-list"),b;a.$wrapper.on("click",".js-remove-api-token",function(e){e.preventDefault();var f=d(this).parents(".js-token-item"),g=f.find(".icon16");e=f.data("token");var h=f.data("contact-id"),h={action:"remove",
token_id:e,contact_id:h};!b&&e&&confirm(a.locale.remove_ask)&&(b=!0,g.removeClass("no").addClass("loading"),d.post("?module=apiTokensRemove",h,function(a){a.status&&"ok"===a.status?(f.remove(),c.find(".js-token-item")):(b=!1,g.removeClass("loading").addClass("no"))}).always(function(){b=!1;g.removeClass("loading").addClass("no")}))})};return SiteApiTokenPage}(jQuery);var UserList=function(d){UserList=function(a){this.$wrapper=a.$wrapper;this.$items=this.$wrapper.find(".t-user-wrapper");this.xhr=this.is_locked=!1;this.initClass()};UserList.prototype.initClass=function(){this.initHightlight();this.bindEvents()};UserList.prototype.bindEvents=function(){var a=!1;this.$wrapper.find(".js-move-user").draggable({helper:"clone",delay:200,cursorAt:{top:10,left:20},start:function(c,b){b.helper.addClass("is-clone");a=d.team.sidebar.$wrapper.find(".js-drop-block");a.length&&
a.addClass("t-drop-here")},stop:function(c,b){var d=b.helper,f=d.clone();f.insertAfter(d).fadeOut(270);setTimeout(function(){f.remove()},300);a.length&&a.removeClass("t-drop-here")}})};UserList.prototype.initHightlight=function(){function a(a){return new Date(a.year,a.month-1,a.day,a.hours,a.minutes,a.seconds)}var c=d.team.sidebar.link_count_update_date;c&&(c=a(c),this.$items.each(function(){var b=d(this),e=b.data("update-datetime");if(e&&e.length){var f=e.split(" "),e=f[0].split("-"),f=f[1].split(":"),
e={year:parseInt(e[0]),month:parseInt(e[1]),day:parseInt(e[2]),hours:parseInt(f[0]),minutes:parseInt(f[1]),seconds:parseInt(f[2])};a(e)>c&&b.addClass("highlighted")}}))};return UserList}(jQuery);var WelcomePage=function(d){WelcomePage=function(a){this.$wrapper=a.$wrapper;this.$inviteWrapper=this.$wrapper.find("#t-invite-wrapper");this.$inviteList=this.$inviteWrapper.find(".t-invite-list");this.locales=a.locales;this.error_class="error";this.is_locked=!1;this.initClass()};WelcomePage.prototype.initClass=function(){var a=this;d(document).on("ready",function(){d.team.content.is_enabled=!1});a.$inviteList.find("input:checkbox").each(function(){a.initIButton(d(this))});a.bindEvents()};WelcomePage.prototype.bindEvents=
function(){var a=this;a.$wrapper.on("click",".js-skip-page",function(a){a.stopPropagation()});a.$wrapper.on("click",".js-send-invites",function(c){c.preventDefault();a.is_locked||a.sendInvites()});a.$inviteWrapper.on("click",".js-add-invite",function(c){c.preventDefault();a.addNewInvite()});a.$inviteWrapper.on("click",".js-remove-invite",function(a){a.preventDefault();d(this).closest("li").remove()});a.$inviteWrapper.on("click","."+a.error_class,function(){a.removeErrors(d(this))})};WelcomePage.prototype.initIButton=
function(a){a.iButton({labelOn:"",labelOff:"",classContainer:"t-ibutton ibutton-container mini"})};WelcomePage.prototype.addNewInvite=function(){var a=this.$inviteWrapper.find(".t-invite-template").clone().html(),a=d("<li>"+a+"</li>");this.$inviteList.append(a);a=a.find("input:checkbox");this.initIButton(a)};WelcomePage.prototype.sendInvites=function(){function a(a){var b=[];d.each(a,function(a,d){var e=d.text,f=parseInt(d.name.replace("data[","").replace("][email]","")),f=c.$inviteList.find(".t-invite-item").eq(f).find(".t-field");
f.length&&b.push({$field:f,locale:e})});c.displayErrors(b)}var c=this,b=d.team.app_url+"?module=welcome&action=save",e=function(){var a=[],b=[];c.$inviteList.find(".t-invite-item").each(function(e){var f=d(this).find("input:text"),g=d(this).find("input:checkbox"),h=f.val(),g="checked"==g.attr("checked");d.trim(h).length&&(h.match(".+@.+")?(a.push({name:"data["+e+"][email]",value:h}),a.push({name:"data["+e+"][access]",value:g})):b.push({$field:f,locale:c.locales.incorrect}))});return b.length?(c.displayErrors(b),
!1):a.length?a:!1}();c.is_locked=!0;e?d.post(b,e,function(b){b.errors&&b.errors.length?a(b.errors):location.href=d.team.app_url}).always(function(){c.is_locked=!1}):c.is_locked=!1};WelcomePage.prototype.removeErrors=function(a){var c=this.error_class;a?(a.removeClass(c),a.parent().find(".t-error").remove()):(this.$inviteList.find(".t-error").remove(),this.$inviteList.find("."+c).removeClass(c))};WelcomePage.prototype.displayErrors=function(a){var c=this.error_class;this.removeErrors();d.each(a,function(a,
d){var b='<span class="t-error">'+d.locale+"</span>";d.$field.addClass(c).before(b)})};return WelcomePage}(jQuery);var LongActionProcess=function(d){var a="",c="",b=500,e=750,f=[],g={},h=null,k,l,m,n,q,v,x,y,w=!1,E=function(){for(;0<f.length;){var a=f.shift();a&&clearTimeout(a)}},r=function(){var b=d.extend(!0,{},g);b.processId=c;b.cleanup=1;d.post(a,b,function(a){k&&k(a)}).always(function(){E()})},p=function(k){w||(k=k||b,k=setTimeout(function(){var b=d.extend(!0,{},g);b.processId=c;d.post(a,b,function(a){a?a.ready?(l&&l.call(h,a),r()):a.error?n&&n.call(h,a):a.progress?(m&&m.call(h,a),p()):a.warning?(q&&q.call(h,
a),p()):p(e):p(e);y&&y.call(h,a)},"json").error(function(){p(e)})},k),f.push(k))},t=function(c){if(!c.url)throw Error("Url is required");a=c.url;b=c.step_delay||b;e=c.rest_delay||e;g=c.post_data||g;k=c.onCleanup;l=c.onReady;m=c.onProgress;n=c.onError;q=c.onWarning;v=c.onStart;x=c.onStop;y=c.onAlways;h=this};d.extend(t.prototype,{start:function(){v&&v();var b=d.extend(!0,{},g);d.post(a,b,function(a){a&&a.processId?(c=a.processId,p(100),p(200)):a&&a.error?n&&n.call(h,a):n&&n.call(h,"Server error")},
"json").error(function(){n&&n.call(h,"Server error")})},stop:function(){w=!0;x&&x.call(h);E()}});return t}(jQuery);var TeamMap=function(d){var a=function(a,b,e){if(!a)throw Error("DOM element is required");this.$map=d(a);(this.provider=b)&&0>["google","yandex","disabled"].indexOf(this.provider)&&console.error("Not supported map provider: %s".replace("%s",this.provider));this.map_info=null;this.initClass()};a.prototype.initClass=function(){};a.prototype.render=function(a,b){switch(this.provider){case "google":return this.googleRender(a,b);case "yandex":return this.yandexRender(a,b)}};a.prototype.googleRender=function(c,
b){var e=this;e.map_info=e.map_info||{};var f=new google.maps.LatLng(c,b);if(!e.map_info.map){var g={zoom:12,center:f,mapTypeId:google.maps.MapTypeId.ROADMAP};e.map_info.map=new google.maps.Map(e.$map.get(0),g)}e.map_info.marker&&e.map_info.marker.setMap(null);e.map_info.marker=new google.maps.Marker({position:f,map:e.map_info.map});e.map_info.map.setCenter(f);a.google_error_html=a.google_error_html||"";setTimeout(function(){if(e.$map.find(".gm-err-container").length)e.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+
d.team.locales.map_check_your_key+"</div>"),a.google_error_html=e.$map.find(".gm-err-container").parent().html();else if(!e.$map.find(".gm-style").length)if(a.google_error_html)e.$map.children().html(a.google_error_html);else{var b;b='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>'.replace(":title:",
d.team.locales.map_error_title);b=b.replace(":message1:",d.team.locales.map_error_message);b=b.replace(":message2:",d.team.locales.map_check_your_key);e.$map.children().html(b)}},5E3)};a.prototype.yandexRender=function(a,b){this.map_info=this.map_info||{};var c=[a,b];if(!this.map_info.map){var d={zoom:12,center:c,controls:["zoomControl","fullscreenControl"]};this.map_info.map=new ymaps.Map(this.$map.get(0),d)}this.map_info.marker&&this.map_info.map.geoObjects.remove(this.map_info.marker);this.map_info.marker=
new ymaps.Placemark(c);this.map_info.map.geoObjects.add(this.map_info.marker);this.map_info.map.setCenter(c)};a.prototype.geocode=function(a,b,d){switch(this.provider){case "google":return this.googleGeocode(a,b,d);case "yandex":return this.yandexGeocode(a,b,d);default:d?d():b&&b()}};a.prototype.googleGeocode=function(a,b,d){var c=!1,e=!1;(new google.maps.Geocoder).geocode({address:a},function(a,f){c=!0;if(!e)if(f==google.maps.GeocoderStatus.OK){var g=a[0].geometry.location;b(g.lat(),g.lng())}else d&&
d()});setTimeout(function(){c||(e=!0,d&&d(!0))},5E3)};a.prototype.yandexGeocode=function(a,b,d){ymaps.geocode(a,{results:1}).then(function(a){var c=1;a.metaData&&a.metaData.geocoder&&"found"in a.metaData.geocoder&&(c=a.metaData.geocoder.found);0>=c?d():(a=a.geoObjects.get(0).geometry.getCoordinates(),b(a[0],a[1]))},function(a){d(a)})};return a}(jQuery);
